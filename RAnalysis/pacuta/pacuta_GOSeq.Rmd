---
title: "pacuta GOSeq"
author: "jillashey"
date: "1/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries
library("DESeq2")
library("tidyverse")
library("dplyr")
library("pheatmap")
library("RColorBrewer")
library("genefilter")
library("ggplot2")
library("gplots")
library("limma")
library("spdep") 
library("adegenet") 
library("goseq")
library("gridExtra")
library("clusterProfiler")
library("DataCombine")
library("VennDiagram")
```

This code is using the pacuta data. This code is also using the GO terms generated by Diamond (B2G), Swiss Prot (B2G), and IPS in Jan. 2022. 

## Read in all expressed ofav genes (poverA = 0.85,5)
```{r}
# Obtain names of all expressed Ofav genes (poverA = 0.85,5), and all differentially expressed genes (p<0.05)
gcounts_filt_pacuta <- read.csv("Output/DESeq2/pacuta/pacuta_counts_filt_20220116.csv", header = T)
dim(gcounts_filt_pacuta) # 23559 rows x 13
colnames(gcounts_filt_pacuta)[1] <-"gene_id" # make colnames a true column called gene_id
length(unique(gcounts_filt_pacuta$gene_id)) # 23559 total unique gene ids 
for ( col in 1:ncol(gcounts_filt_pacuta)){
  colnames(gcounts_filt_pacuta)[col] <-  gsub("X", "", colnames(gcounts_filt_pacuta)[col])
}
head(gcounts_filt_pacuta)
```

## Read in pacuta DEGs
```{r}
DEG_pacuta <- read.csv("Output/DESeq2/pacuta/pacuta_unique.sig.list_20220116.csv", header = TRUE)
dim(DEG_pacuta) # 263 x 13
colnames(DEG_pacuta)[1] <-"gene_id" # make colnames a true column called gene_id
for ( col in 1:ncol(DEG_pacuta)){
  colnames(DEG_pacuta)[col] <-  gsub("X", "", colnames(DEG_pacuta)[col])
}
head(DEG_pacuta)
length(unique(DEG_pacuta$gene_id)) # 263 total unique gene ids 
```

## Read in length data (calculated directly from transcripts) and merge with filtered counts 
```{r}
length_pacuta <- read.csv("Output/DESeq2/pacuta/length.mRNA_Pacuta.csv")

length_merge <- merge(length_pacuta, gcounts_filt_pacuta, by = "gene_id")
```

# Build GOSEQ vector 
GOseq requires a vector of all genes, all differentially expressed genes, and gene lengths

## Make vectors
```{r}
#DEG<- filter(length_Acerv, gene_id %in% DEG_acerv_sub$gene_id) - for some reason, R keeps giving me error saying object 'gene_id' not found, so used another way below
DEG <- length_merge[length_merge$gene_id %in% DEG_pacuta$gene_id, ]
dim(DEG) # 263 x 14
DEG_names <- as.vector(DEG$gene_id)
gene_vector <- as.integer(length_merge$gene_id%in%DEG_names)
names(gene_vector) <- length_merge$gene_id

# Make ID vector 
IDvector <- length_merge$gene_id

# Make length vector
lengthVector <- length_merge$length
lengthVector <- as.numeric(lengthVector)
```

## Calculate Probability Weighting Function
```{r}
DEG.pwf<-nullp(gene_vector, IDvector, bias.data=lengthVector) #weight vector by length of gene

# plot looks weird...does this mean that there is not much length bias in the dataset?
```











