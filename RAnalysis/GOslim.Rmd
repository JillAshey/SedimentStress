---
title: "GOslim"
author: "jillashey"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load packages 
library(readr)
library(arsenal)
library(tidyverse)
```

This code uses GO term annotation generated in Nov-Dec 2021 and Jan 2022

## Acerv
```{r}
# Read in acerv DEG GO terms 
acerv.go <- read.csv("Output/GOSeq/acerv/acerv_sub_ByTreatment_GO.terms_20211104.csv", header = T)
acerv.go <- select(acerv.go, c("category", "term", "ontology", "over_represented_pvalue")) # can add treatment compare if interested 
colnames(acerv.go)[1] <-"GO.IDs"
acerv.go$Species <- "A.cervicornis"
acerv.go$Site <- "Florida"
acerv.go <- unique(acerv.go)
length(unique(acerv.go$GO.IDs)) # 366 unique GO terms 

# Subset by BP
acerv.go.BP <- subset(acerv.go, ontology == "BP")
acerv.go.BP <- unique(acerv.go.BP)
length(unique(acerv.go.BP$GO.IDs)) # 278 unique BP GO terms 
```

## Mcav
```{r}
# Read in Mcav DEG GO terms 
mcav.go <- read.csv("Output/GOSeq/mcav/mcav_ByTreatment_GO.terms_20211109.csv", header = T)
mcav.go <- select(mcav.go, c("category", "term", "ontology", "over_represented_pvalue")) # can add treatment compare if interested 
colnames(mcav.go)[1] <-"GO.IDs"
mcav.go$Species <- "M.cavernosa"
mcav.go$Site <- "Florida"
mcav.go <- unique(mcav.go)
length(unique(mcav.go$GO.IDs)) # 220 unique GO terms 

# Subset by BP
mcav.go.BP <- subset(mcav.go, ontology == "BP")
mcav.go.BP <- unique(mcav.go.BP)
length(unique(mcav.go.BP$GO.IDs)) # 158 unique BP GO terms 
```

## Ofav
```{r}
# Read in Ofav DEG GO terms 
ofav.go <- read.csv("Output/GOSeq/ofav/ofav_ByTreatment_GO.terms_20220111.csv", header = T)
ofav.go <- select(ofav.go, c("category", "term", "ontology", "over_represented_pvalue")) # can add treatment compare if interested 
colnames(ofav.go)[1] <-"GO.IDs"
ofav.go$Species <- "O.faveolata"
ofav.go$Site <- "Florida"
ofav.go <- unique(ofav.go)
length(unique(ofav.go$GO.IDs)) # 39 unique GO terms 

# Subset by BP
ofav.go.BP <- subset(ofav.go, ontology == "BP")
ofav.go.BP <- unique(ofav.go.BP)
length(unique(ofav.go.BP$GO.IDs)) # 27 unique BP GO terms 
```

## Pacuta 
```{r}
# Read in pacuta DEG GO terms
pacuta.go <- read.csv("Output/GOSeq/pacuta/pacuta_ByTreatment_GO.terms_20220121.csv", header = T)
pacuta.go <- select(pacuta.go, c("category", "term", "ontology", "over_represented_pvalue")) # can add treatment compare if interested 
colnames(pacuta.go)[1] <-"GO.IDs"
pacuta.go$Species <- "P.acuta"
pacuta.go$Site <- "Hawaii"
pacuta.go <- unique(pacuta.go)
length(unique(pacuta.go$GO.IDs)) # 532 unique GO terms 

# Subset by BP
pacuta.go.BP <- subset(pacuta.go, ontology == "BP")
pacuta.go.BP <- unique(pacuta.go.BP)
length(unique(pacuta.go.BP$GO.IDs)) # 380 unique BP GO terms 
```

## Plob 
```{r}
# Read in plob DEG GO terms
plob.go <- read.csv("Output/GOSeq/plob/plob_ByTreatment_GO.terms_20211106.csv", header = T)
plob.go <- select(plob.go, c("category", "term", "ontology", "over_represented_pvalue")) # can add treatment compare if interested 
colnames(plob.go)[1] <-"GO.IDs"
plob.go$Species <- "P.lobata"
plob.go$Site <- "Hawaii"
plob.go <- unique(plob.go)
length(unique(plob.go$GO.IDs)) # 279 unique GO terms 

# Subset by BP
plob.go.BP <- subset(plob.go, ontology == "BP")
plob.go.BP <- unique(plob.go.BP)
length(unique(plob.go.BP$GO.IDs)) # 198 unique BP GO terms 
```


## Merge w/ GO slim terms 
```{r}
# Read in go slim info
go.slim <- read_csv("Output/GOSeq/GO-GOslim.csv")
colnames(go.slim) <- c("GO.IDs", "GO.Term", "GO.Slim.Term", "Cat") #rename columns

# Bind all species df together for GO slim plot and merge w/ GO slim terms
all.go <- rbind(acerv.go, 
                     mcav.go, 
                     ofav.go,
                     pacuta.go, 
                     plob.go)
write.csv(all.go, "Output/GOSeq/all.go_20220121.csv")
all.go.slim <- merge(all.go, go.slim, by="GO.IDs", all = TRUE)
write.csv(all.go.slim, "Output/GOSeq/all.go.slim_20220121.csv")

# Plot 
all.go.slim <- na.omit(all.go.slim)
GO.all <- ggplot(all.go.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.all
ggsave("Output/Figs/all_GOslim_20220121.pdf", GO.all, width = 40, height = 40, units = c("in"))





# Bind all species df together for BP GO slim plot and merge w/ GO slim terms
all.go.BP <- rbind(acerv.go.BP, 
                     mcav.go.BP, 
                     ofav.go.BP,
                     pacuta.go.BP, 
                     plob.go.BP)
write.csv(all.go.BP, "Output/GOSeq/all.go.BP_20220121.csv")
all.go.BP.slim <- merge(all.go.BP, go.slim, by="GO.IDs", all = TRUE)
write.csv(all.go.BP.slim, "Output/GOSeq/all.go.BP.slim_20220121.csv")

# Plot 
all.go.BP.slim <- na.omit(all.go.BP.slim)
GO.BP.all <- ggplot(all.go.BP.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.BP.all
ggsave("Output/Figs/all_GOslim.BP_20220121.pdf", GO.BP.all, width = 40, height = 40, units = c("in"))
```

# Subset by GO slim term and plot for all species 
### Determine all categories to plot by
```{r}
unique(all.go.BP.slim$GO.Slim.Term)
#  [1] "transport"                        "RNA metabolism"                   "cell organization and biogenesis" "protein metabolism"              
#  [5] "DNA metabolism"                   "stress response"                  "developmental processes"          "other biological processes"      
#  [9] "cell cycle and proliferation"     "cell adhesion"                    "other metabolic processes"        "death"                           
# [13] "signal transduction"              "cell-cell signaling"                                      
```

Look at all_GOslim.BP plot to see which GOslim term has the most associated GO terms. Then, plot by that GOslim term. Going to subset and plot by GOslim terms that appear in all_GOslim.BP_20220121.pdf: 

(1) "cell adhesion"
(2) "cell cycle and proliferation"
(3) "cell organization and biogenesis"
(4) "cell-cell signaling"
(5) "death"
(6) "developmental processes"
(7) "DNA metabolism"
(8) "other biological processes"
(9) "other metabolic processes"
(10) "protein metabolism"
(11) "RNA metabolism"
(12) "signal transduction" 
(13) "stress response"
(14) "transport 


### Plots 

(1) "cell adhesion"
```{r}
go.slim.CA.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell adhesion")

GO.CA.subset <- ggplot(go.slim.CA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CA.subset
ggsave("Output/Figs/CA.Subset_GOslim.BP_20220121.pdf", GO.CA.subset, width = 40, height = 40, units = c("in"))
```


(2) "cell cycle and proliferation"
```{r}
go.slim.CCP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell cycle and proliferation")

GO.CCP.subset <- ggplot(go.slim.CCP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CCP.subset
ggsave("Output/Figs/CCP.Subset_GOslim.BP_20220121.pdf", GO.CCP.subset, width = 40, height = 40, units = c("in"))
```


(3) "cell organization and biogenesis"
```{r}
go.slim.COB.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell organization and biogenesis")

GO.COB.subset <- ggplot(go.slim.COB.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.COB.subset
ggsave("Output/Figs/COB.Subset_GOslim.BP_20220121.pdf", GO.COB.subset, width = 40, height = 40, units = c("in"))
```


(4) "cell-cell signaling"
```{r}
go.slim.CCS.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell-cell signaling")

GO.CCS.subset <- ggplot(go.slim.CCS.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CCS.subset
ggsave("Output/Figs/CCS.Subset_GOslim.BP_20220121.pdf", GO.CCS.subset, width = 40, height = 40, units = c("in"))
```


(5) "death"
```{r}
go.slim.Death.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="death")

GO.death.subset <- ggplot(go.slim.Death.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.death.subset
ggsave("Output/Figs/Death.Subset_GOslim.BP_20220121.pdf", GO.death.subset, width = 40, height = 40, units = c("in"))
```

(6) "developmental processes"
```{r}
go.slim.DP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="developmental processes")

GO.DP.subset <- ggplot(go.slim.DP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.DP.subset
ggsave("Output/Figs/DP.Subset_GOslim.BP_20220121.pdf", GO.DP.subset, width = 40, height = 40, units = c("in"))
```


(7) "DNA metabolism"
```{r}
go.slim.DNAM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="DNA metabolism")

GO.DNAM.subset <- ggplot(go.slim.DNAM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.DNAM.subset
ggsave("Output/Figs/DNAM.Subset_GOslim.BP_20220121.pdf", GO.DNAM.subset, width = 40, height = 40, units = c("in"))
```

(8) "other biological processes"
```{r}
go.slim.OBP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="other biological processes")

GO.OBP.subset <- ggplot(go.slim.OBP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OBP.subset
ggsave("Output/Figs/OBP.Subset_GOslim.BP_20220121.pdf", GO.OBP.subset, width = 40, height = 40, units = c("in"))
```

(9) "other metabolic processes"
```{r}
go.slim.OMP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="other metabolic processes")

GO.OMP.subset <- ggplot(go.slim.OMP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OMP.subset
ggsave("Output/Figs/OMP.Subset_GOslim.BP_20220121.pdf", GO.OMP.subset, width = 40, height = 40, units = c("in"))
```

(10) "protein metabolism"
```{r}
go.slim.PM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="protein metabolism")

GO.PM.subset <- ggplot(go.slim.PM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.PM.subset
ggsave("Output/Figs/PM.Subset_GOslim.BP_20220121.pdf", GO.PM.subset, width = 40, height = 40, units = c("in"))
```


(11) "RNA metabolism"
```{r}
go.slim.RNAM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="RNA metabolism")

GO.RNAM.subset <- ggplot(go.slim.RNAM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.RNAM.subset
ggsave("Output/Figs/RNAM.Subset_GOslim.BP_20220121.pdf", GO.RNAM.subset, width = 40, height = 40, units = c("in"))
```

(12) "signal transduction"
```{r}
go.slim.ST.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="signal transduction")

GO.ST.subset <- ggplot(go.slim.ST.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.ST.subset
ggsave("Output/Figs/ST.Subset_GOslim.BP_20220121.pdf", GO.ST.subset, width = 40, height = 40, units = c("in"))
```

(13) "stress response"
```{r}
go.slim.SR.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="stress response")

GO.SR.subset <- ggplot(go.slim.SR.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.SR.subset
ggsave("Output/Figs/SR.Subset_GOslim.BP_20220121.pdf", GO.SR.subset, width = 40, height = 40, units = c("in"))
```

(14) "transport"
```{r}
go.slim.T.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="transport")

GO.T.subset <- ggplot(go.slim.T.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.T.subset
ggsave("Output/Figs/Transport.Subset_GOslim.BP_20220121.pdf", GO.T.subset, width = 40, height = 40, units = c("in"))
```


Plot by species?