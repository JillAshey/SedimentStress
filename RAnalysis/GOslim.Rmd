---
title: "GOslim"
author: "jillashey"
date: "10/11/2021"
output: html_document
---


20220920 note to self - try this link https://sfirke.github.io/janitor/reference/get_dupes.htmlhttps://sfirke.github.io/janitor/reference/get_dupes.html to identify duplicates in dataset 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load packages 
library(readr)
library(arsenal)
library(tidyverse)
#library(UpSetR)
library(ComplexUpset)

## NOTE: cannot use UpSetR and ComplexUpset at the same time
```

This code uses GO term annotation generated in Nov-Dec 2021 and Jan 2022

# Read in go slim info
```{r}
go.slim <- read_csv("Output/GOSeq/GO-GOslim.csv")
colnames(go.slim) <- c("GO.IDs", "GO.Term", "GO.Slim.Term", "Cat") #rename columns
```

The specific csv I used was obtained from HP's Geoduck_Meth [repo](https://github.com/hputnam/Geoduck_Meth/blob/master/RAnalysis/Data/20210407_map2MGIslim.csv). It was used in this [script](https://github.com/hputnam/Geoduck_Meth/blob/master/RAnalysis/Scripts/GM.Rmd#L1648) and was accessed on 20210407 from [here](http://www.informatics.jax.org/gotools/data/input/map2MGIslim.txt). 

## Florida 

### Acerv
```{r}
# Read in acerv DEG GO terms 
acerv.go <- read.csv("Output/GOSeq/acerv/acerv_sub_ByTreatment_GO.terms_20211104.csv", header = T)
acerv.go <- select(acerv.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(acerv.go)[2] <-"GO.IDs"
acerv.go$Species <- "A.cervicornis"
acerv.go$Site <- "Florida"
acerv.go <- unique(acerv.go)
length(unique(acerv.go$GO.IDs)) # 366 unique GO terms 

# Merge w/ GO slim and subset by ontology
acerv.go.slim <- merge(acerv.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(acerv.go.slim, "Output/GOSeq/acerv/acerv.go.slim_20220208.csv")

acerv.go.slim.BP <- subset(acerv.go.slim, ontology == "BP")
acerv.go.slim.BP <- unique(acerv.go.slim.BP)
length(unique(acerv.go.slim.BP$GO.IDs)) # 278 unique BP GO terms 
#write.csv(acerv.go.slim.BP, "Output/GOSeq/acerv/acerv.go.slim.BP_20220208.csv")
acerv.go.slim.BP_uniq <- acerv.go.slim.BP %>% select("GO.IDs")
acerv.go.slim.BP_uniq <- unique(acerv.go.slim.BP_uniq)
#write.csv(acerv.go.slim.BP_uniq, "Output/GOSeq/acerv/acerv.go.slim.BP_unique_20220418.csv")

acerv.go.slim.CC <- subset(acerv.go.slim, ontology == "CC")
acerv.go.slim.CC <- unique(acerv.go.slim.CC)
length(unique(acerv.go.slim.CC$GO.IDs)) # 34 unique CC GO terms 
#write.csv(acerv.go.slim.CC, "Output/GOSeq/acerv/acerv.go.slim.CC_20220208.csv")
acerv.go.slim.CC_uniq <- acerv.go.slim.CC %>% select("GO.IDs")
acerv.go.slim.CC_uniq <- unique(acerv.go.slim.CC_uniq)
#write.csv(acerv.go.slim.CC_uniq, "Output/GOSeq/acerv/acerv.go.slim.CC_unique_20220418.csv")

acerv.go.slim.MF <- subset(acerv.go.slim, ontology == "MF")
acerv.go.slim.MF <- unique(acerv.go.slim.MF)
length(unique(acerv.go.slim.MF$GO.IDs)) # 54 unique MF GO terms 
#write.csv(acerv.go.slim.MF, "Output/GOSeq/acerv/acerv.go.slim.MF_20220208.csv")
acerv.go.slim.MF_uniq <- acerv.go.slim.MF %>% select("GO.IDs")
acerv.go.slim.MF_uniq <- unique(acerv.go.slim.MF_uniq)
#write.csv(acerv.go.slim.MF_uniq, "Output/GOSeq/acerv/acerv.go.slim.MF_unique_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

### Mcav
```{r}
# Read in Mcav DEG GO terms 
mcav.go <- read.csv("Output/GOSeq/mcav/mcav_ByTreatment_GO.terms_20211109.csv", header = T)
mcav.go <- select(mcav.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(mcav.go)[2] <-"GO.IDs"
mcav.go$Species <- "M.cavernosa"
mcav.go$Site <- "Florida"
mcav.go <- unique(mcav.go)
length(unique(mcav.go$GO.IDs)) # 220 unique GO terms 

# Merge w/ GO slim and subset by ontology
mcav.go.slim <- merge(mcav.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(mcav.go.slim, "Output/GOSeq/mcav/mcav.go.slim_20220208.csv")

mcav_all.go.slim.BP <- subset(mcav.go.slim, ontology == "BP")
mcav_all.go.slim.BP <- unique(mcav_all.go.slim.BP)
length(unique(mcav_all.go.slim.BP$GO.IDs)) # 158 unique BP GO terms 
#write.csv(mcav_all.go.slim.BP, "Output/GOSeq/mcav/mcav.go.slim.BP_20220208.csv")
mcav_all.go.slim.BP_uniq <- mcav_all.go.slim.BP %>% select("GO.IDs")
mcav_all.go.slim.BP_uniq <- unique(mcav_all.go.slim.BP_uniq)
#write.csv(mcav_all.go.slim.BP_uniq, "Output/GOSeq/mcav/mcav.go.slim.BP_unique_20220418.csv")

mcav_all.go.slim.CC <- subset(mcav.go.slim, ontology == "CC")
mcav_all.go.slim.CC <- unique(mcav_all.go.slim.CC)
length(unique(mcav_all.go.slim.CC$GO.IDs)) # 21 unique BP GO terms 
#write.csv(mcav_all.go.slim.CC, "Output/GOSeq/mcav/mcav.go.slim.CC_20220208.csv")
mcav_all.go.slim.CC_uniq <- mcav_all.go.slim.CC %>% select("GO.IDs")
mcav_all.go.slim.CC_uniq <- unique(mcav_all.go.slim.CC_uniq)
#write.csv(mcav_all.go.slim.CC_uniq, "Output/GOSeq/mcav/mcav.go.slim.CC_unique_20220418.csv")

mcav_all.go.slim.MF <- subset(mcav.go.slim, ontology == "MF")
mcav_all.go.slim.MF <- unique(mcav_all.go.slim.MF)
length(unique(mcav_all.go.slim.MF$GO.IDs)) # 39 unique BP GO terms 
#write.csv(mcav_all.go.slim.MF, "Output/GOSeq/mcav/mcav.go.slim.MF_20220208.csv")
mcav_all.go.slim.MF_uniq <- mcav_all.go.slim.MF %>% select("GO.IDs")
mcav_all.go.slim.MF_uniq <- unique(mcav_all.go.slim.MF_uniq)
#write.csv(mcav_all.go.slim.MF_uniq, "Output/GOSeq/mcav/mcav.go.slim.MF_unique_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

### Ofav
```{r}
# Read in Ofav DEG GO terms 
ofav.go <- read.csv("Output/GOSeq/ofav/ofav_ByTreatment_GO.terms_20220111.csv", header = T)
ofav.go <- select(ofav.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(ofav.go)[2] <-"GO.IDs"
ofav.go$Species <- "O.faveolata"
ofav.go$Site <- "Florida"
ofav.go <- unique(ofav.go)
length(unique(ofav.go$GO.IDs)) # 39 unique GO terms 

# Merge w/ GO slim and subset by ontology
ofav.go.slim <- merge(ofav.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(ofav.go.slim, "Output/GOSeq/ofav/ofav.go.slim_20220208.csv")

ofav_all.go.slim.BP <- subset(ofav.go.slim, ontology == "BP")
ofav_all.go.slim.BP <- unique(ofav_all.go.slim.BP)
length(unique(ofav_all.go.slim.BP$GO.IDs)) # 27 unique BP GO terms 
#write.csv(ofav_all.go.slim.BP, "Output/GOSeq/ofav/ofav.go.slim.BP_20220208.csv")
ofav_all.go.slim.BP_uniq <- ofav_all.go.slim.BP %>% select("GO.IDs")
ofav_all.go.slim.BP_uniq <- unique(ofav_all.go.slim.BP_uniq)
#write.csv(ofav_all.go.slim.BP_uniq, "Output/GOSeq/ofav/ofav_all.go.slim.BP_uniq_20220418.csv")

ofav_all.go.slim.CC <- subset(ofav.go.slim, ontology == "CC")
ofav_all.go.slim.CC <- unique(ofav_all.go.slim.CC)
length(unique(ofav_all.go.slim.CC$GO.IDs)) # 3 unique BP GO terms 
#write.csv(ofav_all.go.slim.CC, "Output/GOSeq/ofav/ofav.go.slim.CC_20220208.csv")
ofav_all.go.slim.CC_uniq <- ofav_all.go.slim.CC %>% select("GO.IDs")
ofav_all.go.slim.CC_uniq <- unique(ofav_all.go.slim.CC_uniq)
#write.csv(ofav_all.go.slim.CC_uniq, "Output/GOSeq/ofav/ofav_all.go.slim.CC_uniq_20220418.csv")

ofav_all.go.slim.MF <- subset(ofav.go.slim, ontology == "MF")
ofav_all.go.slim.MF <- unique(ofav_all.go.slim.MF)
length(unique(ofav_all.go.slim.MF$GO.IDs)) # 9 unique BP GO terms 
#write.csv(ofav_all.go.slim.MF, "Output/GOSeq/ofav/ofav.go.slim.MF_20220208.csv")
ofav_all.go.slim.MF_uniq <- ofav_all.go.slim.MF %>% select("GO.IDs")
ofav_all.go.slim.MF_uniq <- unique(ofav_all.go.slim.CC_uniq)
#write.csv(ofav_all.go.slim.MF_uniq, "Output/GOSeq/ofav/ofav_all.go.slim.MF_uniq_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

## Hawaii

### Mcap 
```{r}
# Read in mcap DEG GO terms
mcap.go <- read.csv("Output/GOSeq/mcap/mcap_ByTreatment_GO.terms_20220417.csv", header = T)
mcap.go <- select(mcap.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(mcap.go)[2] <-"GO.IDs"
mcap.go$Species <- "M.capitata"
mcap.go$Site <- "Hawai'i"
mcap.go <- unique(mcap.go)
length(unique(mcap.go$GO.IDs)) # 343 unique GO terms 

# Merge w/ GO slim and subset by ontology
mcap.go.slim <- merge(mcap.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(mcap.go.slim, "Output/GOSeq/mcap/mcap.go.slim_20220417.csv")

mcap_all.go.slim.BP <- subset(mcap.go.slim, ontology == "BP")
mcap_all.go.slim.BP <- unique(mcap_all.go.slim.BP)
length(unique(mcap_all.go.slim.BP$GO.IDs)) # 237 unique BP GO terms 
#write.csv(pacuta_all.go.slim.BP, "Output/GOSeq/mcap/mcap.go.slim.BP_20220417.csv")
mcap_all.go.slim.BP_uniq <- mcap_all.go.slim.BP %>% select("GO.IDs")
mcap_all.go.slim.BP_uniq <- unique(mcap_all.go.slim.BP_uniq)
#write.csv(mcap_all.go.slim.BP_uniq, "Output/GOSeq/mcap/mcap_all.go.slim.BP_uniq_20220418.csv")

mcap_all.go.slim.CC <- subset(mcap.go.slim, ontology == "CC")
mcap_all.go.slim.CC <- unique(mcap_all.go.slim.CC)
length(unique(mcap_all.go.slim.CC$GO.IDs)) # 40 unique BP GO terms 
#write.csv(mcap_all.go.slim.CC, "Output/GOSeq/mcap/mcap.go.slim.CC_20220417.csv")
mcap_all.go.slim.CC_uniq <- mcap_all.go.slim.CC %>% select("GO.IDs")
mcap_all.go.slim.CC_uniq <- unique(mcap_all.go.slim.CC_uniq)
#write.csv(mcap_all.go.slim.CC_uniq, "Output/GOSeq/mcap/mcap_all.go.slim.CC_uniq_20220418.csv")

mcap_all.go.slim.MF <- subset(mcap.go.slim, ontology == "MF")
mcap_all.go.slim.MF <- unique(mcap_all.go.slim.MF)
length(unique(mcap_all.go.slim.MF$GO.IDs)) # 65 unique BP GO terms 
#write.csv(mcap_all.go.slim.MF, "Output/GOSeq/mcap/mcap.go.slim.MF_20220417.csv")
mcap_all.go.slim.MF_uniq <- mcap_all.go.slim.MF %>% select("GO.IDs")
mcap_all.go.slim.MF_uniq <- unique(mcap_all.go.slim.MF_uniq)
#write.csv(mcap_all.go.slim.MF_uniq, "Output/GOSeq/mcap/mcap_all.go.slim.MF_uniq_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

### Pacuta 
```{r}
# Read in pacuta DEG GO terms
pacuta.go <- read.csv("Output/GOSeq/pacuta/pacuta_ByTreatment_GO.terms_20220121.csv", header = T)
pacuta.go <- select(pacuta.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(pacuta.go)[2] <-"GO.IDs"
pacuta.go$Species <- "P.acuta"
pacuta.go$Site <- "Hawai'i"
pacuta.go <- unique(pacuta.go)
length(unique(pacuta.go$GO.IDs)) # 532 unique GO terms 

# Merge w/ GO slim and subset by ontology
pacuta.go.slim <- merge(pacuta.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(pacuta.go.slim, "Output/GOSeq/pacuta/pacuta.go.slim_20220208.csv")

pacuta_all.go.slim.BP <- subset(pacuta.go.slim, ontology == "BP")
pacuta_all.go.slim.BP <- unique(pacuta_all.go.slim.BP)
length(unique(pacuta_all.go.slim.BP$GO.IDs)) # 380 unique BP GO terms 
#write.csv(pacuta_all.go.slim.BP, "Output/GOSeq/pacuta/pacuta.go.slim.BP_20220208.csv")
pacuta_all.go.slim.BP_uniq <- pacuta_all.go.slim.BP %>% select("GO.IDs")
pacuta_all.go.slim.BP_uniq <- unique(pacuta_all.go.slim.BP_uniq)
#write.csv(pacuta_all.go.slim.BP_uniq, "Output/GOSeq/pacuta/pacuta_all.go.slim.BP_uniq_20220418.csv")

pacuta_all.go.slim.CC <- subset(pacuta.go.slim, ontology == "CC")
pacuta_all.go.slim.CC <- unique(pacuta_all.go.slim.CC)
length(unique(pacuta_all.go.slim.CC$GO.IDs)) # 25 unique CC GO terms 
#write.csv(pacuta_all.go.slim.CC, "Output/GOSeq/pacuta/pacuta.go.slim.CC_20220208.csv")
pacuta_all.go.slim.CC_uniq <- pacuta_all.go.slim.CC %>% select("GO.IDs")
pacuta_all.go.slim.CC_uniq <- unique(pacuta_all.go.slim.CC_uniq)
#write.csv(pacuta_all.go.slim.CC_uniq, "Output/GOSeq/pacuta/pacuta_all.go.slim.CC_uniq_20220418.csv")

pacuta_all.go.slim.MF <- subset(pacuta.go.slim, ontology == "MF")
pacuta_all.go.slim.MF <- unique(pacuta_all.go.slim.MF)
length(unique(pacuta_all.go.slim.MF$GO.IDs)) # 126 unique MF GO terms 
#write.csv(pacuta_all.go.slim.MF, "Output/GOSeq/pacuta/pacuta.go.slim.MF_20220208.csv")
pacuta_all.go.slim.MF_uniq <- pacuta_all.go.slim.MF %>% select("GO.IDs")
pacuta_all.go.slim.MF_uniq <- unique(pacuta_all.go.slim.MF_uniq)
#write.csv(pacuta_all.go.slim.MF_uniq, "Output/GOSeq/pacuta/pacuta_all.go.slim.MF_uniq_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

### Plob 
```{r}
# Read in plob DEG GO terms
plob.go <- read.csv("Output/GOSeq/plob/plob_ByTreatment_GO.terms_20211106.csv", header = T)
plob.go <- select(plob.go, c("gene_id", "category", "term", "ontology", "over_represented_pvalue", "log2FoldChange", "padj", "Treatment_Compare")) # can add treatment compare if interested 
colnames(plob.go)[2] <-"GO.IDs"
plob.go$Species <- "P.lobata"
plob.go$Site <- "Hawai'i"
plob.go <- unique(plob.go)
length(unique(plob.go$GO.IDs)) # 279 unique GO terms 

# Merge w/ GO slim and subset by ontology
plob.go.slim <- merge(plob.go, go.slim, by="GO.IDs", all = TRUE)
#write.csv(plob.go.slim, "Output/GOSeq/plob/plob.go.slim_20220208.csv")

plob_all.go.slim.BP <- subset(plob.go.slim, ontology == "BP")
plob_all.go.slim.BP <- unique(plob_all.go.slim.BP)
length(unique(plob_all.go.slim.BP$GO.IDs)) # 198 unique BP GO terms 
#write.csv(plob_all.go.slim.BP, "Output/GOSeq/plob/plob.go.slim.BP_20220208.csv")
plob_all.go.slim.BP_uniq <- plob_all.go.slim.BP %>% select("GO.IDs")
plob_all.go.slim.BP_uniq <- unique(plob_all.go.slim.BP_uniq)
#write.csv(plob_all.go.slim.BP_uniq, "Output/GOSeq/plob/plob_all.go.slim.BP_uniq_20220418.csv")

plob_all.go.slim.CC <- subset(plob.go.slim, ontology == "CC")
plob_all.go.slim.CC <- unique(plob_all.go.slim.CC)
length(unique(plob_all.go.slim.CC$GO.IDs)) # 31 unique CC GO terms 
#write.csv(plob_all.go.slim.CC, "Output/GOSeq/plob/plob.go.slim.CC_20220208.csv")
plob_all.go.slim.CC_uniq <- plob_all.go.slim.CC %>% select("GO.IDs")
plob_all.go.slim.CC_uniq <- unique(plob_all.go.slim.CC_uniq)
#write.csv(plob_all.go.slim.CC_uniq, "Output/GOSeq/plob/plob_all.go.slim.CC_uniq_20220418.csv")

plob_all.go.slim.MF <- subset(plob.go.slim, ontology == "MF")
plob_all.go.slim.MF <- unique(plob_all.go.slim.MF)
length(unique(plob_all.go.slim.MF$GO.IDs)) # 50 unique MF GO terms 
#write.csv(plob_all.go.slim.MF, "Output/GOSeq/plob/plob.go.slim.MF_20220208.csv")
plob_all.go.slim.MF_uniq <- plob_all.go.slim.MF %>% select("GO.IDs")
plob_all.go.slim.MF_uniq <- unique(plob_all.go.slim.MF_uniq)
#write.csv(plob_all.go.slim.MF_uniq, "Output/GOSeq/plob/plob_all.go.slim.MF_uniq_20220418.csv")

## In Excel, I take the unique go term files, remove excess rows/cols so its just a list of GO terms. Then plotted using this website: https://bioinformatics.psb.ugent.be/cgi-bin/liste/Venn/calculate_venn.htpl. can't figure out how to do it in R
```

I used the unique docs for all the species to make 6-way venn diagram with this [website](https://bioinformatics.psb.ugent.be/webtools/Venn/).

## Upset plots w/ GO terms (written on 20221125)
```{r}
### All 
# Subset so each species df contains only gene ID and GO ID columns 
acerv.go_upset <- acerv.go[,1:2]
mcav.go_upset <- mcav.go[,1:2]
ofav.go_upset <- ofav.go[,1:2]
mcap.go_upset <- mcap.go[,1:2]
pacuta.go_upset <- pacuta.go[,1:2]
plob.go_upset <- plob.go[,1:2]

# Replace NAs with 0 and other values to 1 - may need to do this first to avoid duplicates bc some genes have multiple orthogroups or vice versa 
acerv.go_upset <- unique(acerv.go_upset)
acerv.go_upset$gene_id <- ifelse(is.na(acerv.go_upset$gene_id),0,1)
acerv.go_upset <- unique(acerv.go_upset)

mcav.go_upset <- unique(mcav.go_upset)
mcav.go_upset$gene_id <- ifelse(is.na(mcav.go_upset$gene_id),0,1)
mcav.go_upset <- unique(mcav.go_upset)

ofav.go_upset <- unique(ofav.go_upset)
ofav.go_upset$gene_id <- ifelse(is.na(ofav.go_upset$gene_id),0,1)
ofav.go_upset <- unique(ofav.go_upset)

mcap.go_upset <- unique(mcap.go_upset)
mcap.go_upset$gene_id <- ifelse(is.na(mcap.go_upset$gene_id),0,1)
mcap.go_upset <- unique(mcap.go_upset)

pacuta.go_upset <- unique(pacuta.go_upset)
pacuta.go_upset$gene_id <- ifelse(is.na(pacuta.go_upset$gene_id),0,1)
pacuta.go_upset <- unique(pacuta.go_upset)

plob.go_upset <- unique(plob.go_upset)
plob.go_upset$gene_id <- ifelse(is.na(plob.go_upset$gene_id),0,1)
plob.go_upset <- unique(plob.go_upset)

# Merge all GO tables
go1 <- full_join(acerv.go_upset, mcav.go_upset, by = "GO.IDs")
go2 <- full_join(go1, ofav.go_upset, by = "GO.IDs")
go3 <- full_join(go2, mcap.go_upset, by = "GO.IDs")
go4 <- full_join(go3, pacuta.go_upset, by = "GO.IDs")
go5 <- full_join(go4, plob.go_upset, by = "GO.IDs")

# Reorganize table & rename columns 
go <- go5[,c(2,1,3,4,5,6,7)] # moved orthogroup column to be first column 
colnames(go) <- c("GO.IDs", "Acervicornis", "Mcavernosa", "Ofaveolata", "Mcapitata", "Pacuta", "Plobata")
go <- unique(go) # remove duplicate rows

# Replacing NAs with 0 and other values to 1 
go$Acervicornis <- ifelse(is.na(go$Acervicornis),0,1)
go$Mcavernosa <- ifelse(is.na(go$Mcavernosa),0,1)
go$Ofaveolata <- ifelse(is.na(go$Ofaveolata),0,1)
go$Mcapitata <- ifelse(is.na(go$Mcapitata),0,1)
go$Pacuta <- ifelse(is.na(go$Pacuta),0,1)
go$Plobata <- ifelse(is.na(go$Plobata),0,1)

## change column/species names so that they will look nice in the plot (i.e. change Acervicornis to A. cervicornis and make italic in plot). I guess I could do it in the above step
colnames(go) <- c("Orthogroup", "A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata")

# Upset plot w/ ALL GO terms 
upset_go.all <- upset(
  go,
  c("A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata"),
  queries=list(
    upset_query(set='A. cervicornis', fill='chartreuse3'),
    upset_query(set='M. cavernosa', fill='chartreuse3'),
    upset_query(set='O. faveolata', fill='chartreuse3'),
    upset_query(set='M. capitata', fill='chocolate2'),
    upset_query(set='P. acuta', fill='chocolate2'),
    upset_query(set='P. lobata', fill='chocolate2')
  ),
  base_annotations=list(
    'Intersection size'=(     # this creates the bar plot showing intersection size (top right corner)
        intersection_size(
        bar_number_threshold=0.85,  # show all numbers on top of bars
        width=0.9,   # reduce width of the bars
        text = list(size=10), # change text size over bars
        text_colors = c(on_background = "black", on_bar = "white"), # change text color for text over bars
      )
      + scale_y_continuous(expand=expansion(mult=c(0, 0.05))) # add some space on the top of the bars
      + theme(
          panel.grid.major=element_blank(), # hide grid lines
          panel.grid.minor=element_blank(), # hide grid lines
          axis.line=element_line(colour='black', size = 2), # show axis lines
          axis.title.y = element_text(size = 35, colour = "black"), 
          axis.text.y = element_text(size = 30, colour = "black")
      )
    )
  ),
  stripes=upset_stripes(    # this changes the color of the stripes in the matrix (underneath the bar plot, bottom right corner)
    geom=geom_segment(size=35),  # make the stripes larger  ---  REMEMBER to check color order for all species
    colors = c("#E4E408", # Ofav - massive      REMEMBER to check color order for all species
              "#E4E408", # Mcav - massive 
             "#E4E408",  # Plobata - massive
              "#A0A0A0", # Mcap - intermediate
             "#0066CC",  # Acerv - branching 
             "#0066CC")  # Pacuta - branching 
  ),
    #0066CC = blue; #E4E408 = yellow; #A0A0A0 = gray
  matrix=intersection_matrix( # this changes the circles and connecting lines in the matrix
      geom=geom_point(
        shape='circle filled', # to prevent connectors from getting the color, use `fill` instead of `color`, together with `shape='circle filled'
        size=10,
        stroke=0.5
      ), 
      segment=geom_segment(size=2)
  ),
  set_sizes=( # this changes the set size bar plot (in the bottom left corner)
    upset_set_size(geom=geom_bar(width=0.5, colour = "black"))
    + theme(
      axis.line.x=element_line(colour='black', size = 2),
      axis.line.y = element_line(colour = 'black'),
      axis.ticks.x=element_line(),
      axis.text.x = element_text(size = 25, colour = "black"),
      axis.title.x = element_text(size = 30, colour = "black"),
    )
  ),
  themes = upset_modify_themes(
       list(
           'intersections_matrix' = theme(text = element_text(size = 50, face = "italic", colour = "black")), # text to the left of the matrix
          'overall_sizes' = theme(axis.text.x = element_text(angle = 0)) # text underneath set size plot
       )),
  sort_sets = 'descending', # sort sets in descending order
  sort_intersections = 'descending' # sort intersections in descending order
)
#upset_go.all

ggsave("Output/Figs/upset/upset_all_GO_20221205.pdf", upset_go.all, width = 40, height = 20, units = c("in"))
ggsave("Output/Figs/upset/upset_all_GO_20221205.png", upset_go.all, width = 40, height = 20, units = c("in"))




### BP 
# Subset for BP
acerv.go.bp <- subset(acerv.go, ontology == "BP")
mcav.go.bp <- subset(mcav.go, ontology == "BP")
ofav.go.bp <- subset(ofav.go, ontology == "BP")
mcap.go.bp <- subset(mcap.go, ontology == "BP")
pacuta.go.bp <- subset(pacuta.go, ontology == "BP")
plob.go.bp <- subset(plob.go, ontology == "BP")

# Subset so each species df contains only gene ID and BP GO ID columns 
acerv.go.bp_upset <- acerv.go.bp[,1:2]
mcav.go.bp_upset <- mcav.go.bp[,1:2]
ofav.go.bp_upset <- ofav.go.bp[,1:2]
mcap.go.bp_upset <- mcap.go.bp[,1:2]
pacuta.go.bp_upset <- pacuta.go.bp[,1:2]
plob.go.bp_upset <- plob.go.bp[,1:2]

# Replace NAs with 0 and other values to 1 - may need to do this first to avoid duplicates bc some genes have multiple orthogroups or vice versa 
acerv.go.bp_upset <- unique(acerv.go.bp_upset)
acerv.go.bp_upset$gene_id <- ifelse(is.na(acerv.go.bp_upset$gene_id),0,1)
acerv.go.bp_upset <- unique(acerv.go.bp_upset)

mcav.go.bp_upset <- unique(mcav.go.bp_upset)
mcav.go.bp_upset$gene_id <- ifelse(is.na(mcav.go.bp_upset$gene_id),0,1)
mcav.go.bp_upset <- unique(mcav.go.bp_upset)

ofav.go.bp_upset <- unique(ofav.go.bp_upset)
ofav.go.bp_upset$gene_id <- ifelse(is.na(ofav.go.bp_upset$gene_id),0,1)
ofav.go.bp_upset <- unique(ofav.go.bp_upset)

mcap.go.bp_upset <- unique(mcap.go.bp_upset)
mcap.go.bp_upset$gene_id <- ifelse(is.na(mcap.go.bp_upset$gene_id),0,1)
mcap.go.bp_upset <- unique(mcap.go.bp_upset)

pacuta.go.bp_upset <- unique(pacuta.go.bp_upset)
pacuta.go.bp_upset$gene_id <- ifelse(is.na(pacuta.go.bp_upset$gene_id),0,1)
pacuta.go.bp_upset <- unique(pacuta.go.bp_upset)

plob.go.bp_upset <- unique(plob.go.bp_upset)
plob.go.bp_upset$gene_id <- ifelse(is.na(plob.go.bp_upset$gene_id),0,1)
plob.go.bp_upset <- unique(plob.go.bp_upset)

# Merge BP GO tables
go.bp1 <- full_join(acerv.go.bp_upset, mcav.go.bp_upset, by = "GO.IDs")
go.bp2 <- full_join(go.bp1, ofav.go.bp_upset, by = "GO.IDs")
go.bp3 <- full_join(go.bp2, mcap.go.bp_upset, by = "GO.IDs")
go.bp4 <- full_join(go.bp3, pacuta.go.bp_upset, by = "GO.IDs")
go.bp5 <- full_join(go.bp4, plob.go.bp_upset, by = "GO.IDs")

# Reorganize table & rename columns 
go.bp <- go.bp5[,c(2,1,3,4,5,6,7)] # moved orthogroup column to be first column 
colnames(go.bp) <- c("GO.IDs", "Acervicornis", "Mcavernosa", "Ofaveolata", "Mcapitata", "Pacuta", "Plobata")
go.bp <- unique(go.bp) # remove duplicate rows

# Replacing NAs with 0 and other values to 1 
go.bp$Acervicornis <- ifelse(is.na(go.bp$Acervicornis),0,1)
go.bp$Mcavernosa <- ifelse(is.na(go.bp$Mcavernosa),0,1)
go.bp$Ofaveolata <- ifelse(is.na(go.bp$Ofaveolata),0,1)
go.bp$Mcapitata <- ifelse(is.na(go.bp$Mcapitata),0,1)
go.bp$Pacuta <- ifelse(is.na(go.bp$Pacuta),0,1)
go.bp$Plobata <- ifelse(is.na(go.bp$Plobata),0,1)

## change column/species names so that they will look nice in the plot (i.e. change Acervicornis to A. cervicornis and make italic in plot). I guess I could do it in the above step
colnames(go.bp) <- c("Orthogroup", "A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata")

# Upset plot w/ BP GO terms 
upset_go.bp <- upset(
  go.bp,
  c("A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata"),
  queries=list(
    upset_query(set='A. cervicornis', fill='chartreuse3'),
    upset_query(set='M. cavernosa', fill='chartreuse3'),
    upset_query(set='O. faveolata', fill='chartreuse3'),
    upset_query(set='M. capitata', fill='chocolate2'),
    upset_query(set='P. acuta', fill='chocolate2'),
    upset_query(set='P. lobata', fill='chocolate2')
  ),
  base_annotations=list(
    'Intersection size'=(     # this creates the bar plot showing intersection size (top right corner)
        intersection_size(
        bar_number_threshold=0.85,  # show all numbers on top of bars
        width=0.9,   # reduce width of the bars
        text = list(size=10), # change text size over bars
        text_colors = c(on_background = "black", on_bar = "white"), # change text color for text over bars
      )
      + scale_y_continuous(expand=expansion(mult=c(0, 0.05))) # add some space on the top of the bars
      + theme(
          panel.grid.major=element_blank(), # hide grid lines
          panel.grid.minor=element_blank(), # hide grid lines
          axis.line=element_line(colour='black', size = 2), # show axis lines
          axis.title.y = element_text(size = 35, colour = "black"), 
          axis.text.y = element_text(size = 30, colour = "black")
      )
    )
  ),
  stripes=upset_stripes(    # this changes the color of the stripes in the matrix (underneath the bar plot, bottom right corner)
    geom=geom_segment(size=35),  # make the stripes larger  ---  REMEMBER to check color order for all species
    colors=c("#E4E408", # Ofav - massive  
              "#E4E408", # Mcav - massive 
             "#E4E408",  # Plobata - massive
              "#A0A0A0", # Mcap - intermediate
              "#0066CC",  # Acerv - branching 
              "#0066CC")  # Pacuta - branching 
  ),
    #0066CC = blue; #E4E408 = yellow; #A0A0A0 = gray
  matrix=intersection_matrix( # this changes the circles and connecting lines in the matrix
      geom=geom_point(
        shape='circle filled', # to prevent connectors from getting the color, use `fill` instead of `color`, together with `shape='circle filled'
        size=10,
        stroke=0.5
      ), 
      segment=geom_segment(size=2)
  ),
  set_sizes=( # this changes the set size bar plot (in the bottom left corner)
    upset_set_size(geom=geom_bar(width=0.5, colour = "black"))
    + theme(
      axis.line.x=element_line(colour='black', size = 2),
      axis.line.y = element_line(colour = 'black'),
      axis.ticks.x=element_line(),
      axis.text.x = element_text(size = 25, colour = "black"),
      axis.title.x = element_text(size = 30, colour = "black"),
    )
  ),
  themes = upset_modify_themes(
       list(
           'intersections_matrix' = theme(text = element_text(size = 50, face = "italic", colour = "black")), # text to the left of the matrix
          'overall_sizes' = theme(axis.text.x = element_text(angle = 0)) # text underneath set size plot
       )),
  sort_sets = 'descending', # sort sets in descending order
  sort_intersections = 'descending' # sort intersections in descending order
)
upset_go.bp
ggsave("Output/Figs/upset/upset_GO.BP_20221205.pdf", upset_go.bp, width = 40, height = 20, units = c("in"))
ggsave("Output/Figs/upset/upset_GO.BP_20221205.png", upset_go.bp, width = 40, height = 20, units = c("in"))




### CC 
# Subset for CC
acerv.go.cc <- subset(acerv.go, ontology == "CC")
mcav.go.cc <- subset(mcav.go, ontology == "CC")
ofav.go.cc <- subset(ofav.go, ontology == "CC")
mcap.go.cc <- subset(mcap.go, ontology == "CC")
pacuta.go.cc <- subset(pacuta.go, ontology == "CC")
plob.go.cc <- subset(plob.go, ontology == "CC")

# Subset so each species df contains only gene ID and CC GO ID columns 
acerv.go.cc_upset <- acerv.go.cc[,1:2]
mcav.go.cc_upset <- mcav.go.cc[,1:2]
ofav.go.cc_upset <- ofav.go.cc[,1:2]
mcap.go.cc_upset <- mcap.go.cc[,1:2]
pacuta.go.cc_upset <- pacuta.go.cc[,1:2]
plob.go.cc_upset <- plob.go.cc[,1:2]

# Replace NAs with 0 and other values to 1 - may need to do this first to avoid duplicates bc some genes have multiple orthogroups or vice versa 
acerv.go.cc_upset <- unique(acerv.go.cc_upset)
acerv.go.cc_upset$gene_id <- ifelse(is.na(acerv.go.cc_upset$gene_id),0,1)
acerv.go.cc_upset <- unique(acerv.go.cc_upset)

mcav.go.cc_upset <- unique(mcav.go.cc_upset)
mcav.go.cc_upset$gene_id <- ifelse(is.na(mcav.go.cc_upset$gene_id),0,1)
mcav.go.cc_upset <- unique(mcav.go.cc_upset)

ofav.go.cc_upset <- unique(ofav.go.cc_upset)
ofav.go.cc_upset$gene_id <- ifelse(is.na(ofav.go.cc_upset$gene_id),0,1)
ofav.go.cc_upset <- unique(ofav.go.cc_upset)

mcap.go.cc_upset <- unique(mcap.go.cc_upset)
mcap.go.cc_upset$gene_id <- ifelse(is.na(mcap.go.cc_upset$gene_id),0,1)
mcap.go.cc_upset <- unique(mcap.go.cc_upset)

pacuta.go.cc_upset <- unique(pacuta.go.cc_upset)
pacuta.go.cc_upset$gene_id <- ifelse(is.na(pacuta.go.cc_upset$gene_id),0,1)
pacuta.go.cc_upset <- unique(pacuta.go.cc_upset)

plob.go.cc_upset <- unique(plob.go.cc_upset)
plob.go.cc_upset$gene_id <- ifelse(is.na(plob.go.cc_upset$gene_id),0,1)
plob.go.cc_upset <- unique(plob.go.cc_upset)

# Merge CC GO tables
go.cc1 <- full_join(acerv.go.cc_upset, mcav.go.cc_upset, by = "GO.IDs")
go.cc2 <- full_join(go.cc1, ofav.go.cc_upset, by = "GO.IDs")
go.cc3 <- full_join(go.cc2, mcap.go.cc_upset, by = "GO.IDs")
go.cc4 <- full_join(go.cc3, pacuta.go.cc_upset, by = "GO.IDs")
go.cc5 <- full_join(go.cc4, plob.go.cc_upset, by = "GO.IDs")

# Reorganize table & rename columns 
go.cc <- go.cc5[,c(2,1,3,4,5,6,7)] # moved orthogroup column to be first column 
colnames(go.cc) <- c("GO.IDs", "Acervicornis", "Mcavernosa", "Ofaveolata", "Mcapitata", "Pacuta", "Plobata")
go.cc <- unique(go.cc) # remove duplicate rows

# Replacing NAs with 0 and other values to 1 
go.cc$Acervicornis <- ifelse(is.na(go.cc$Acervicornis),0,1)
go.cc$Mcavernosa <- ifelse(is.na(go.cc$Mcavernosa),0,1)
go.cc$Ofaveolata <- ifelse(is.na(go.cc$Ofaveolata),0,1)
go.cc$Mcapitata <- ifelse(is.na(go.cc$Mcapitata),0,1)
go.cc$Pacuta <- ifelse(is.na(go.cc$Pacuta),0,1)
go.cc$Plobata <- ifelse(is.na(go.cc$Plobata),0,1)

## change column/species names so that they will look nice in the plot (i.e. change Acervicornis to A. cervicornis and make italic in plot). I guess I could do it in the above step
colnames(go.cc) <- c("Orthogroup", "A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata")

# Upset plot w/ CC GO terms 
upset_go.cc <- upset(
  go.cc,
  c("A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata"),
  queries=list(
    upset_query(set='A. cervicornis', fill='chartreuse3'),
    upset_query(set='M. cavernosa', fill='chartreuse3'),
    upset_query(set='O. faveolata', fill='chartreuse3'),
    upset_query(set='M. capitata', fill='chocolate2'),
    upset_query(set='P. acuta', fill='chocolate2'),
    upset_query(set='P. lobata', fill='chocolate2')
  ),
  base_annotations=list(
    'Intersection size'=(     # this creates the bar plot showing intersection size (top right corner)
        intersection_size(
        bar_number_threshold=0.85,  # show all numbers on top of bars
        width=0.9,   # reduce width of the bars
        text = list(size=10), # change text size over bars
        text_colors = c(on_background = "black", on_bar = "white"), # change text color for text over bars
      )
      + scale_y_continuous(expand=expansion(mult=c(0, 0.05))) # add some space on the top of the bars
      + theme(
          panel.grid.major=element_blank(), # hide grid lines
          panel.grid.minor=element_blank(), # hide grid lines
          axis.line=element_line(colour='black', size = 2), # show axis lines
          axis.title.y = element_text(size = 35, colour = "black"), 
          axis.text.y = element_text(size = 30, colour = "black")
      )
    )
  ),
  stripes=upset_stripes(    # this changes the color of the stripes in the matrix (underneath the bar plot, bottom right corner)
    geom=geom_segment(size=35),  # make the stripes larger  ---  REMEMBER to check color order for all species
    colors=c( "#E4E408",  # Ofav - massive 
             "#E4E408",  # Mcav - massive 
            "#0066CC", # Pacuta - branching  
             "#E4E408",  # Plobata - massive
            "#0066CC", # Acerv - branching 
            "#A0A0A0") # Mcap - intermediate
  ),
    #0066CC = blue; #E4E408 = yellow; #A0A0A0 = gray
  matrix=intersection_matrix( # this changes the circles and connecting lines in the matrix
      geom=geom_point(
        shape='circle filled', # to prevent connectors from getting the color, use `fill` instead of `color`, together with `shape='circle filled'
        size=10,
        stroke=0.5
      ), 
      segment=geom_segment(size=2)
  ),
  set_sizes=( # this changes the set size bar plot (in the bottom left corner)
    upset_set_size(geom=geom_bar(width=0.5, colour = "black"))
    + theme(
      axis.line.x=element_line(colour='black', size = 2),
      axis.line.y = element_line(colour = 'black'),
      axis.ticks.x=element_line(),
      axis.text.x = element_text(size = 25, colour = "black"),
      axis.title.x = element_text(size = 30, colour = "black"),
    )
  ),
  themes = upset_modify_themes(
       list(
           'intersections_matrix' = theme(text = element_text(size = 50, face = "italic", colour = "black")), # text to the left of the matrix
          'overall_sizes' = theme(axis.text.x = element_text(angle = 0)) # text underneath set size plot
       )),
  sort_sets = 'descending', # sort sets in descending order
  sort_intersections = 'descending' # sort intersections in descending order
)

#upset_go.cc
ggsave("Output/Figs/upset/upset_GO.CC_20221205.pdf", upset_go.cc, width = 40, height = 20, units = c("in"))
ggsave("Output/Figs/upset/upset_GO.CC_20221205.png", upset_go.cc, width = 40, height = 20, units = c("in"))




### MF
# Subset for MF
acerv.go.mf <- subset(acerv.go, ontology == "MF")
mcav.go.mf <- subset(mcav.go, ontology == "MF")
ofav.go.mf <- subset(ofav.go, ontology == "MF")
mcap.go.mf <- subset(mcap.go, ontology == "MF")
pacuta.go.mf <- subset(pacuta.go, ontology == "MF")
plob.go.mf <- subset(plob.go, ontology == "MF")

# Subset so each species df contains only gene ID and MF GO ID columns 
acerv.go.mf_upset <- acerv.go.mf[,1:2]
mcav.go.mf_upset <- mcav.go.mf[,1:2]
ofav.go.mf_upset <- ofav.go.mf[,1:2]
mcap.go.mf_upset <- mcap.go.mf[,1:2]
pacuta.go.mf_upset <- pacuta.go.mf[,1:2]
plob.go.mf_upset <- plob.go.mf[,1:2]

# Replace NAs with 0 and other values to 1 - may need to do this first to avoid duplicates bc some genes have multiple orthogroups or vice versa 
acerv.go.mf_upset <- unique(acerv.go.mf_upset)
acerv.go.mf_upset$gene_id <- ifelse(is.na(acerv.go.mf_upset$gene_id),0,1)
acerv.go.mf_upset <- unique(acerv.go.mf_upset)

mcav.go.mf_upset <- unique(mcav.go.mf_upset)
mcav.go.mf_upset$gene_id <- ifelse(is.na(mcav.go.mf_upset$gene_id),0,1)
mcav.go.mf_upset <- unique(mcav.go.mf_upset)

ofav.go.mf_upset <- unique(ofav.go.mf_upset)
ofav.go.mf_upset$gene_id <- ifelse(is.na(ofav.go.mf_upset$gene_id),0,1)
ofav.go.mf_upset <- unique(ofav.go.mf_upset)

mcap.go.mf_upset <- unique(mcap.go.mf_upset)
mcap.go.mf_upset$gene_id <- ifelse(is.na(mcap.go.mf_upset$gene_id),0,1)
mcap.go.mf_upset <- unique(mcap.go.mf_upset)

pacuta.go.mf_upset <- unique(pacuta.go.mf_upset)
pacuta.go.mf_upset$gene_id <- ifelse(is.na(pacuta.go.mf_upset$gene_id),0,1)
pacuta.go.mf_upset <- unique(pacuta.go.mf_upset)

plob.go.mf_upset <- unique(plob.go.mf_upset)
plob.go.mf_upset$gene_id <- ifelse(is.na(plob.go.mf_upset$gene_id),0,1)
plob.go.mf_upset <- unique(plob.go.mf_upset)

# Merge MF GO tables
go.mf1 <- full_join(acerv.go.mf_upset, mcav.go.mf_upset, by = "GO.IDs")
go.mf2 <- full_join(go.mf1, ofav.go.mf_upset, by = "GO.IDs")
go.mf3 <- full_join(go.mf2, mcap.go.mf_upset, by = "GO.IDs")
go.mf4 <- full_join(go.mf3, pacuta.go.mf_upset, by = "GO.IDs")
go.mf5 <- full_join(go.mf4, plob.go.mf_upset, by = "GO.IDs")

# Reorganize table & rename columns 
go.mf <- go.mf5[,c(2,1,3,4,5,6,7)] # moved orthogroup column to be first column 
colnames(go.mf) <- c("GO.IDs", "Acervicornis", "Mcavernosa", "Ofaveolata", "Mcapitata", "Pacuta", "Plobata")
go.mf <- unique(go.mf) # remove duplicate rows

# Replacing NAs with 0 and other values to 1 
go.mf$Acervicornis <- ifelse(is.na(go.mf$Acervicornis),0,1)
go.mf$Mcavernosa <- ifelse(is.na(go.mf$Mcavernosa),0,1)
go.mf$Ofaveolata <- ifelse(is.na(go.mf$Ofaveolata),0,1)
go.mf$Mcapitata <- ifelse(is.na(go.mf$Mcapitata),0,1)
go.mf$Pacuta <- ifelse(is.na(go.mf$Pacuta),0,1)
go.mf$Plobata <- ifelse(is.na(go.mf$Plobata),0,1)

## change column/species names so that they will look nice in the plot (i.e. change Acervicornis to A. cervicornis and make italic in plot). I guess I could do it in the above step
colnames(go.mf) <- c("Orthogroup", "A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata")

# Upset plot w/ BP GO terms 
upset_go.mf <- upset(
  go.mf,
  c("A. cervicornis", "M. cavernosa", "O. faveolata", "M. capitata", "P. acuta", "P. lobata"),
  queries=list(
    upset_query(set='A. cervicornis', fill='chartreuse3'),
    upset_query(set='M. cavernosa', fill='chartreuse3'),
    upset_query(set='O. faveolata', fill='chartreuse3'),
    upset_query(set='M. capitata', fill='chocolate2'),
    upset_query(set='P. acuta', fill='chocolate2'),
    upset_query(set='P. lobata', fill='chocolate2')
  ),
  base_annotations=list(
    'Intersection size'=(     # this creates the bar plot showing intersection size (top right corner)
        intersection_size(
        bar_number_threshold=0.85,  # show all numbers on top of bars
        width=0.9,   # reduce width of the bars
        text = list(size=10), # change text size over bars
        text_colors = c(on_background = "black", on_bar = "white"), # change text color for text over bars
      )
      + scale_y_continuous(expand=expansion(mult=c(0, 0.05))) # add some space on the top of the bars
      + theme(
          panel.grid.major=element_blank(), # hide grid lines
          panel.grid.minor=element_blank(), # hide grid lines
          axis.line=element_line(colour='black', size = 2), # show axis lines
          axis.title.y = element_text(size = 35, colour = "black"), 
          axis.text.y = element_text(size = 30, colour = "black")
      )
    )
  ),
  stripes=upset_stripes(    # this changes the color of the stripes in the matrix (underneath the bar plot, bottom right corner)
    geom=geom_segment(size=35),  # make the stripes larger  ---  REMEMBER to check color order for all species
    colors=c( "#E4E408",  # Ofav - massive 
              "#E4E408",  # Mcav - massive 
              "#E4E408",  # Plobata - massive
              "#0066CC", # Acerv - branching 
              "#A0A0A0", # Mcap - intermediate
              "#0066CC") # Pacuta - branching
  ),
    #0066CC = blue; #E4E408 = yellow; #A0A0A0 = gray
  matrix=intersection_matrix( # this changes the circles and connecting lines in the matrix
      geom=geom_point(
        shape='circle filled', # to prevent connectors from getting the color, use `fill` instead of `color`, together with `shape='circle filled'
        size=10,
        stroke=0.5
      ), 
      segment=geom_segment(size=2)
  ),
  set_sizes=( # this changes the set size bar plot (in the bottom left corner)
    upset_set_size(geom=geom_bar(width=0.5, colour = "black"))
    + theme(
      axis.line.x=element_line(colour='black', size = 2),
      axis.line.y = element_line(colour = 'black'),
      axis.ticks.x=element_line(),
      axis.text.x = element_text(size = 25, colour = "black"),
      axis.title.x = element_text(size = 30, colour = "black"),
    )
  ),
  themes = upset_modify_themes(
       list(
           'intersections_matrix' = theme(text = element_text(size = 50, face = "italic", colour = "black")), # text to the left of the matrix
          'overall_sizes' = theme(axis.text.x = element_text(angle = 0)) # text underneath set size plot
       )),
  sort_sets = 'descending', # sort sets in descending order
  sort_intersections = 'descending' # sort intersections in descending order
)
#upset_go.mf
ggsave("Output/Figs/upset/upset_GO.MF_20221205.pdf", upset_go.mf, width = 40, height = 20, units = c("in"))
ggsave("Output/Figs/upset/upset_GO.MF_20221205.png", upset_go.mf, width = 40, height = 20, units = c("in"))
```








## Combine GO slim terms with all species in single df 
```{r}
# Bind all species df together for GO slim plot 
all.go.slim <- rbind(acerv.go.slim, 
                     mcav.go.slim, 
                     ofav.go.slim,
                     mcap.go.slim,
                     pacuta.go.slim, 
                     plob.go.slim)
#write.csv(all.go.slim, "Output/GOSeq/all.go.slim_20220417.csv")

# Plot 
all.go.slim <- na.omit(all.go.slim)
GO.all <- ggplot(all.go.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.all
#ggsave("Output/Figs/GOslim/all_GOslim_20220417.pdf", GO.all, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/all_GOslim_20220417.png", GO.all, width = 40, height = 40, units = c("in"))


# Bind all species df together for BP GO slim plot 
all.go.BP.slim <- rbind(acerv.go.slim.BP, 
                     mcav_all.go.slim.BP, 
                     ofav_all.go.slim.BP,
                     mcap_all.go.slim.BP,
                     pacuta_all.go.slim.BP, 
                     plob_all.go.slim.BP)
#write.csv(all.go.BP.slim, "Output/GOSeq/all.go.BP.slim_20220417.csv")

# Plot 
all.go.BP.slim <- na.omit(all.go.BP.slim)
GO.BP.all <- ggplot(all.go.BP.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.BP.all
#ggsave("Output/Figs/GOslim/BP/all_GOslim.BP_20220417.pdf", GO.BP.all, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/all_GOslim.BP_20220417.png", GO.BP.all, width = 40, height = 40, units = c("in"))


# Bind all species df together for CC GO slim plot 
all.go.CC.slim <- rbind(acerv.go.slim.CC, 
                     mcav_all.go.slim.CC, 
                     ofav_all.go.slim.CC,
                     mcap_all.go.slim.CC,
                     pacuta_all.go.slim.CC, 
                     plob_all.go.slim.CC)
#write.csv(all.go.CC.slim, "Output/GOSeq/all.go.CC.slim_20220417.csv")

# Plot 
all.go.CC.slim <- na.omit(all.go.CC.slim)
GO.CC.all <- ggplot(all.go.CC.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.CC.all
#ggsave("Output/Figs/GOslim/CC/all_GOslim.CC_20220417.pdf", GO.CC.all, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/all_GOslim.CC_20220417.png", GO.CC.all, width = 40, height = 40, units = c("in"))


# Bind all species df together for MF GO slim plot and merge w/ GO slim terms
all.go.MF.slim <- rbind(acerv.go.slim.MF, 
                     mcav_all.go.slim.MF, 
                     ofav_all.go.slim.MF,
                     pacuta_all.go.slim.MF, 
                     plob_all.go.slim.MF)
#write.csv(all.go.MF.slim, "Output/GOSeq/all.go.MF.slim_20220417.csv")

# Plot 
all.go.MF.slim <- na.omit(all.go.MF.slim)
GO.MF.all <- ggplot(all.go.MF.slim, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 8),
                     strip.text.x = element_text(size = 8),
                     axis.text = element_text(size = 8))
GO.MF.all
#ggsave("Output/Figs/GOslim/MF/all_GOslim.MF_20220417.pdf", GO.MF.all, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/all_GOslim.MF_20220417.png", GO.MF.all, width = 40, height = 40, units = c("in"))
```

Make bar charts for go slim term counts for species, locations, and morphologies - BP only
```{r}
# read in data
all.go.BP.slim <- read.csv("Output/GOSeq/all.go.BP.slim_20220417.csv", header = T)

# Check species names
unique(all.go.BP.slim$Species)
# "A.cervicornis" "M.cavernosa"   "O.faveolata"   "M.capitata"   "P.acuta"       "P.lobata"  

# for this plot, remove "other biological processes",  "other metabolic processes", and NA
#all.go.BP.slim <- subset(all.go.BP.slim, !GO.Slim.Term == "other biological processes" & !GO.Slim.Term == "other metabolic processes")
all.go.BP.slim <- subset(all.go.BP.slim, !GO.Slim.Term == "NA")

# plot by species 
## plotting unique GO terms only - if I plot with all.go.BP.slim, I get duplicate GO slim terms bc its duplicating based on gene id/treatment?
test <- select(all.go.BP.slim, c("GO.IDs", "term", "Species", "GO.Slim.Term"))
test <- unique(test)
test <- na.omit(test)

# count GOslim by species
count_by_group <- test %>%
  dplyr::count(Species, GO.Slim.Term)
count_by_group

# plot
count <- ggplot(count_by_group, aes(fill = Species, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           width = 0.9) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  labs(title="Counts of GO Slim Categories", x ="", y = "Counts") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 65, 
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=60)) + 
  theme(axis.text.y = element_text(size = 60)) +
  theme(axis.title.y = element_text(size = 40)) +
  theme(plot.title = element_text(size = 100, hjust = 0.5)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 100)) + 
  theme(legend.title = element_text(size = 60), 
        legend.key.size = unit(2, "cm"),
        legend.text = element_text(size=60), 
        legend.position = c(0.85, 0.85), 
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.background = element_rect(fill = "white", color = "black")) + 
  scale_fill_manual(values = c("dodgerblue", "goldenrod1", "darkorange1", "seagreen3", "orchid3", "grey"))
count
#ggsave("Output/Figs/GOslim/BP/SpeciesCounts_GOslim.BP_20220417.pdf", count, width = 40, height = 30, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/SpeciesCounts_GOslim.BP_20220417.png", count, width = 40, height = 30, units = c("in"))

# plot by location/sediment type
all.go.BP.slim <- all.go.BP.slim %>% mutate(Location = 
                                              case_when(Species == "A.cervicornis" ~ "Florida", 
                                                        Species == "M.cavernosa" ~ "Florida",
                                                        Species == "O.faveolata" ~ "Florida",
                                                        Species == "M.capitata" ~ "Hawai'i",
                                                        Species == "P.acuta" ~ "Hawai'i",
                                                        Species == "P.lobata" ~ "Hawai'i"))

# count GOslim by location
count_by_location <- all.go.BP.slim %>%
  dplyr::count(Location, GO.Slim.Term)
count_by_location

# plot
count_location_plot <- ggplot(count_by_location, aes(fill = Location, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Location") +
  #coord_flip() +
  theme_bw() +
  #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 750)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("chartreuse3", "chocolate2"))
count_location_plot
ggsave("Output/Figs/GOslim/BP/LocationsCounts_GOslim.BP_20221205.pdf", count_location_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/BP/LocationsCounts_GOslim.BP_20221205.png", count_location_plot, width = 49, height = 40, units = c("in"))

# plot by morphology type
all.go.BP.slim <- all.go.BP.slim %>% mutate(Morphology = 
                                              case_when(Species == "A.cervicornis" ~ "Branching", 
                                                        Species == "M.cavernosa" ~ "Massive",
                                                        Species == "O.faveolata" ~ "Massive",
                                                        Species == "M.capitata" ~ "Intermediate", 
                                                        Species == "P.acuta" ~ "Branching",
                                                        Species == "P.lobata" ~ "Massive"))

# count GOslim by morphology
count_by_morph <- all.go.BP.slim %>%
  dplyr::count(Morphology, GO.Slim.Term)
count_by_morph

# plot
count_morph_plot <- ggplot(count_by_morph, aes(fill = Morphology, y = n, x = GO.Slim.Term)) +
    geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Morphology") +
  #coord_flip() +
  theme_bw() +
    #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 25)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("#0066CC", "#A0A0A0", "#E4E408"))
count_morph_plot
ggsave("Output/Figs/GOslim/BP/MorphologyCounts_GOslim.BP_20221205.pdf", count_morph_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/BP/MorphologyCounts_GOslim.BP_20221205.png", count_morph_plot, width = 49, height = 40, units = c("in"))
```

## Make contingency tables (info [here](https://www.datacamp.com/community/tutorials/contingency-tables-r))
```{r}
# By location
tabl1 <- table(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Location)
tabl1
  #                                  Florida Hawaii
  # cell adhesion                          8     38
  # cell cycle and proliferation          11     72
  # cell organization and biogenesis      44    153
  # cell-cell signaling                   18     18
  # death                                 14     12
  # developmental processes              174    695
  # DNA metabolism                         7     34
  # protein metabolism                    53    109
  # RNA metabolism                        52     75
  # signal transduction                   52     96
  # stress response                       46    101
  # transport                             63     66

rowSums(tabl1)
             #       cell adhesion     cell cycle and proliferation cell organization and biogenesis 
             #                  46                               83                              197 
             # cell-cell signaling                            death          developmental processes 
             #                  36                               26                              869 
             #      DNA metabolism               protein metabolism                   RNA metabolism 
             #                  41                              162                              127 
             # signal transduction                  stress response                        transport 
             #                 148                              147                              129 

colSums(tabl1)
# Florida  Hawaii 
#     542    1469
    
prop.table(table(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Location)) * 100
  #                                     Florida     Hawaii
  # cell adhesion                     0.3978120  1.8896072
  # cell cycle and proliferation      0.5469915  3.5803083
  # cell organization and biogenesis  2.1879662  7.6081551
  # cell-cell signaling               0.8950771  0.8950771
  # death                             0.6961711  0.5967181
  # developmental processes           8.6524117 34.5599204
  # DNA metabolism                    0.3480855  1.6907011
  # protein metabolism                2.6355047  5.4201890
  # RNA metabolism                    2.5857782  3.7294878
  # signal transduction               2.5857782  4.7737444
  # stress response                   2.2874192  5.0223769
  # transport                         3.1327698  3.2819493

chisq.test(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Location)
# 	Pearson's Chi-squared test
# 
# data:  all.go.BP.slim$GO.Slim.Term and all.go.BP.slim$Location
# X-squared = 107.86, df = 11, p-value < 2.2e-16


# By morphology 
tabl2 <- table(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Morphology)
tabl2
  #                                  Branching Massive
  # cell adhesion                           40       6
  # cell cycle and proliferation            73      10
  # cell organization and biogenesis       139      58
  # cell-cell signaling                     30       6
  # death                                   21       5
  # developmental processes                735     134
  # DNA metabolism                          19      22
  # protein metabolism                     116      46
  # RNA metabolism                         105      22
  # signal transduction                    108      40
  # stress response                        126      21
  # transport                              107      22

rowSums(tabl2)
             #       cell adhesion     cell cycle and proliferation cell organization and biogenesis 
             #                  46                               83                              197 
             # cell-cell signaling                            death          developmental processes 
             #                  36                               26                              869 
             #      DNA metabolism               protein metabolism                   RNA metabolism 
             #                  41                              162                              127 
             # signal transduction                  stress response                        transport 
             #                 148                              147                              129 

colSums(tabl2)
# Branching   Massive 
#      1619       392

prop.table(table(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Morphology)) * 100
  #                                   Branching    Massive
  # cell adhesion                     1.9890602  0.2983590
  # cell cycle and proliferation      3.6300348  0.4972650
  # cell organization and biogenesis  6.9119841  2.8841372
  # cell-cell signaling               1.4917951  0.2983590
  # death                             1.0442566  0.2486325
  # developmental processes          36.5489806  6.6633516
  # DNA metabolism                    0.9448036  1.0939831
  # protein metabolism                5.7682745  2.2874192
  # RNA metabolism                    5.2212829  1.0939831
  # signal transduction               5.3704625  1.9890602
  # stress response                   6.2655395  1.0442566
  # transport                         5.3207360  1.0939831

chisq.test(all.go.BP.slim$GO.Slim.Term, all.go.BP.slim$Morphology)
# Pearson's Chi-squared test
# 
# data:  all.go.BP.slim$GO.Slim.Term and all.go.BP.slim$Morphology
# X-squared = 73.386, df = 11, p-value = 2.762e-11
```




# Subset by GO slim term and plot for all species 
In the manuscript, only the BP terms will be presented. The CC and MF terms will be included in the supplementary materials

## BP
### Determine all categories to plot by
```{r}
unique(all.go.BP.slim$GO.Slim.Term)
#  [1] "transport"                        "RNA metabolism"                  
#  [3] "cell organization and biogenesis" "protein metabolism"              
#  [5] "DNA metabolism"                   "stress response"                 
#  [7] "developmental processes"          "cell cycle and proliferation"    
#  [9] "cell adhesion"                    "death"                           
# [11] "signal transduction"              "cell-cell signaling"  
```

Look at all_GOslim.BP plot to see which GOslim term has the most associated GO terms. Then, plot by that GOslim term. 

(1) "cell adhesion"
(2) "cell cycle and proliferation"
(3) "cell organization and biogenesis"
(4) "cell-cell signaling"
(5) "death"
(6) "developmental processes"
(7) "DNA metabolism"
#(8) "other biological processes"
#(9) "other metabolic processes"
(10) "protein metabolism"
(11) "RNA metabolism"
(12) "signal transduction" 
(13) "stress response"
(14) "transport 


### BP Plots 

(1) "cell adhesion"
```{r}
go.slim.CA.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell adhesion")

GO.CA.subset <- ggplot(go.slim.CA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CA.subset
#ggsave("Output/Figs/GOslim/BP/CA.Subset_GOslim.BP_20220417.pdf", GO.CA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/CA.Subset_GOslim.BP_20220417.png", GO.CA.subset, width = 40, height = 40, units = c("in"))
```


(2) "cell cycle and proliferation"
```{r}
go.slim.CCP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell cycle and proliferation")

GO.CCP.subset <- ggplot(go.slim.CCP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CCP.subset
#ggsave("Output/Figs/GOslim/BP/CCP.Subset_GOslim.BP_20220417.pdf", GO.CCP.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/CCP.Subset_GOslim.BP_20220417.png", GO.CCP.subset, width = 40, height = 40, units = c("in"))
```


(3) "cell organization and biogenesis"
```{r}
go.slim.COB.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell organization and biogenesis")

GO.COB.subset <- ggplot(go.slim.COB.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.COB.subset
#ggsave("Output/Figs/GOslim/BP/COB.Subset_GOslim.BP_20220417.pdf", GO.COB.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/COB.Subset_GOslim.BP_20220417.png", GO.COB.subset, width = 40, height = 40, units = c("in"))
```


(4) "cell-cell signaling"
```{r}
go.slim.CCS.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="cell-cell signaling")

GO.CCS.subset <- ggplot(go.slim.CCS.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CCS.subset
#ggsave("Output/Figs/GOslim/BP/CCS.Subset_GOslim.BP_20220417.pdf", GO.CCS.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/CCS.Subset_GOslim.BP_20220417.png", GO.CCS.subset, width = 40, height = 40, units = c("in"))
```


(5) "death"
```{r}
go.slim.Death.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="death")

GO.death.subset <- ggplot(go.slim.Death.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.death.subset
#ggsave("Output/Figs/GOslim/BP/Death.Subset_GOslim.BP_20220417.pdf", GO.death.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/Death.Subset_GOslim.BP_20220417.png", GO.death.subset, width = 40, height = 40, units = c("in"))
```

(6) "developmental processes"
```{r}
go.slim.DP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="developmental processes")

GO.DP.subset <- ggplot(go.slim.DP.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue), size = 100) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE)) +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25), 
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.DP.subset
#ggsave("Output/Figs/GOslim/BP/DP.Subset_GOslim.BP_20220417.pdf", GO.DP.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/DP.Subset_GOslim.BP_20220417.png", GO.DP.subset, width = 40, height = 40, units = c("in"))
```


(7) "DNA metabolism"
```{r}
go.slim.DNAM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="DNA metabolism")

GO.DNAM.subset <- ggplot(go.slim.DNAM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.DNAM.subset
#ggsave("Output/Figs/GOslim/BP/DNAM.Subset_GOslim.BP_20220417.pdf", GO.DNAM.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/DNAM.Subset_GOslim.BP_20220417.png", GO.DNAM.subset, width = 40, height = 40, units = c("in"))
```

(8) "other biological processes"
```{r}
go.slim.OBP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="other biological processes")

GO.OBP.subset <- ggplot(go.slim.OBP.subset, aes(x = Species, y = term)) +
  geom_tile(aes(fill =over_represented_pvalue)) +
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OBP.subset
#ggsave("Output/Figs/GOslim/BP/OBP.Subset_GOslim.BP_20220417.pdf", GO.OBP.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/OBP.Subset_GOslim.BP_20220417.png", GO.OBP.subset, width = 40, height = 40, units = c("in"))
```

(9) "other metabolic processes"
```{r}
go.slim.OMP.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="other metabolic processes")

GO.OMP.subset <- ggplot(go.slim.OMP.subset, aes(x = Species, y = term)) +
  geom_tile(aes(fill =over_represented_pvalue)) +
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OMP.subset
#ggsave("Output/Figs/GOslim/BP/OMP.Subset_GOslim.BP_20220417.pdf", GO.OMP.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/OMP.Subset_GOslim.BP_20220417.png", GO.OMP.subset, width = 40, height = 40, units = c("in"))
```

(10) "protein metabolism"
```{r}
go.slim.PM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="protein metabolism")

GO.PM.subset <- ggplot(go.slim.PM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.PM.subset
#ggsave("Output/Figs/GOslim/BP/PM.Subset_GOslim.BP_20220417.pdf", GO.PM.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/PM.Subset_GOslim.BP_20220417.png", GO.PM.subset, width = 40, height = 40, units = c("in"))
```

(11) "RNA metabolism"
```{r}
go.slim.RNAM.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="RNA metabolism")

GO.RNAM.subset <- ggplot(go.slim.RNAM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.RNAM.subset
#ggsave("Output/Figs/GOslim/BP/RNAM.Subset_GOslim.BP_20220417.pdf", GO.RNAM.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/RNAM.Subset_GOslim.BP_20220417.png", GO.RNAM.subset, width = 40, height = 40, units = c("in"))
```

(12) "signal transduction"
```{r}
go.slim.ST.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="signal transduction")

GO.ST.subset <- ggplot(go.slim.ST.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.ST.subset
#ggsave("Output/Figs/GOslim/BP/ST.Subset_GOslim.BP_20220417.pdf", GO.ST.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/ST.Subset_GOslim.BP_20220417.png", GO.ST.subset, width = 40, height = 40, units = c("in"))

```

(13) "stress response"
```{r}
go.slim.SR.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="stress response")

GO.SR.subset <- ggplot(go.slim.SR.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.SR.subset
#ggsave("Output/Figs/GOslim/BP/SR.Subset_GOslim.BP_20220417.pdf", GO.SR.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/SR.Subset_GOslim.BP_20220417.png", GO.SR.subset, width = 40, height = 40, units = c("in"))
```

(14) "transport"
```{r}
go.slim.T.subset <- all.go.BP.slim %>% filter(GO.Slim.Term=="transport")

GO.T.subset <- ggplot(go.slim.T.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.T.subset
#ggsave("Output/Figs/GOslim/BP/Transport.Subset_GOslim.BP_20220417.pdf", GO.T.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/BP/Transport.Subset_GOslim.BP_20220417.png", GO.T.subset, width = 40, height = 40, units = c("in"))
```







































### CC and MF will be included in supplementary materials

Make bar charts for go slim term counts for species, locations, and morphologies - CC only
```{r}
# read in data
all.go.CC.slim <- read.csv("Output/GOSeq/all.go.CC.slim_20220417.csv", header = T)

# Check species names
unique(all.go.CC.slim$Species)
# "A.cervicornis" "M.cavernosa"   "O.faveolata"   "M.capitata"   "P.acuta"       "P.lobata"  

# for this plot, remove NAs
all.go.CC.slim <- subset(all.go.CC.slim, !GO.Slim.Term == "NA")

# plot by species 
## plotting unique GO terms only - if I plot with all.go.BP.slim, I get duplicate GO slim terms bc its duplicating based on gene id/treatment?
test <- select(all.go.CC.slim, c("GO.IDs", "term", "Species", "GO.Slim.Term"))
test <- unique(test)
test <- na.omit(test)

# count GOslim by species
count_by_group <- test %>%
  dplyr::count(Species, GO.Slim.Term)
count_by_group

# plot
count <- ggplot(count_by_group, aes(fill = Species, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           width = 0.9) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  labs(title="Counts of GO Slim Categories", x ="", y = "Counts") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 65, 
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=60)) + 
  theme(axis.text.y = element_text(size = 60)) +
  theme(axis.title.y = element_text(size = 40)) +
  theme(plot.title = element_text(size = 100, hjust = 0.5)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 20)) + 
  theme(legend.title = element_text(size = 60), 
        legend.key.size = unit(2, "cm"),
        legend.text = element_text(size=60), 
        legend.position = c(0.85, 0.85), 
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.background = element_rect(fill = "white", color = "black")) + 
  scale_fill_manual(values = c("dodgerblue", "goldenrod1", "darkorange1", "seagreen3", "orchid3", "grey"))
count
#ggsave("Output/Figs/GOslim/CC/SpeciesCounts_GOslim.CC_20220417.pdf", count, width = 40, height = 30, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/SpeciesCounts_GOslim.CC_20220417.png", count, width = 40, height = 30, units = c("in"))

# plot by location/sediment type
all.go.CC.slim <- all.go.CC.slim %>% mutate(Location = 
                                              case_when(Species == "A.cervicornis" ~ "Florida", 
                                                        Species == "M.cavernosa" ~ "Florida",
                                                        Species == "O.faveolata" ~ "Florida",
                                                        Species == "M.capitata" ~ "Hawai'i",
                                                        Species == "P.acuta" ~ "Hawai'i",
                                                        Species == "P.lobata" ~ "Hawai'i"))

# count GOslim by location
count_by_location <- all.go.CC.slim %>%
  dplyr::count(Location, GO.Slim.Term)
count_by_location

# plot
count_location_plot <- ggplot(count_by_location, aes(fill = Location, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Location") +
  #coord_flip() +
  theme_bw() +
    #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 120)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("chartreuse3", "chocolate2"))
count_location_plot
ggsave("Output/Figs/GOslim/CC/LocationsCounts_GOslim.CC_20221206.pdf", count_location_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/CC/LocationsCounts_GOslim.CC_20221206.png", count_location_plot, width = 49, height = 40, units = c("in"))

# plot by morphology type
all.go.CC.slim <- all.go.CC.slim %>% mutate(Morphology = 
                                              case_when(Species == "A.cervicornis" ~ "Branching", 
                                                        Species == "M.cavernosa" ~ "Massive",
                                                        Species == "O.faveolata" ~ "Massive",
                                                        Species == "M.capitata" ~ "Intermediate",
                                                        Species == "P.acuta" ~ "Branching",
                                                        Species == "P.lobata" ~ "Massive"))

# count GOslim by morphology
count_by_morph <- all.go.CC.slim %>%
  dplyr::count(Morphology, GO.Slim.Term)
count_by_morph

# plot
count_morph_plot <- ggplot(count_by_morph, aes(fill = Morphology, y = n, x = GO.Slim.Term)) +
    geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Morphology") +
  #coord_flip() +
    theme_bw() +
    #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 125)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("#0066CC", "#A0A0A0", "#E4E408"))
count_morph_plot
ggsave("Output/Figs/GOslim/CC/MorphologyCounts_GOslim.CC_20221206.pdf", count_morph_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/CC/MorphologyCounts_GOslim.CC_20221206.png", count_morph_plot, width = 49, height = 40, units = c("in"))
```

Make bar charts for go slim term counts for species, locations, and morphologies - MF only
```{r}
# read in data
all.go.MF.slim <- read.csv("Output/GOSeq/all.go.MF.slim_20220417.csv", header = T)

# Check species names
unique(all.go.MF.slim$Species)
# "A.cervicornis" "M.cavernosa"   "O.faveolata"   "M.capitata"   "P.acuta"       "P.lobata"  

# for this plot, remove NAs
all.go.MF.slim <- subset(all.go.MF.slim, !GO.Slim.Term == "NA")

# plot by species 
## plotting unique GO terms only - if I plot with all.go.BP.slim, I get duplicate GO slim terms bc its duplicating based on gene id/treatment?
test <- select(all.go.MF.slim, c("GO.IDs", "term", "Species", "GO.Slim.Term"))
test <- unique(test)
test <- na.omit(test)

# count GOslim by species
count_by_group <- test %>%
  dplyr::count(Species, GO.Slim.Term)
count_by_group

# plot
count <- ggplot(count_by_group, aes(fill = Species, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           width = 0.9) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  labs(title="Counts of GO Slim Categories", x ="", y = "Counts") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 65, 
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=60)) + 
  theme(axis.text.y = element_text(size = 60)) +
  theme(axis.title.y = element_text(size = 40)) +
  theme(plot.title = element_text(size = 100, hjust = 0.5)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 100)) + 
  theme(legend.title = element_text(size = 60), 
        legend.key.size = unit(2, "cm"),
        legend.text = element_text(size=60), 
        legend.position = c(0.85, 0.85), 
        legend.justification = c("right", "top"),
        legend.box.just = "right",
        legend.background = element_rect(fill = "white", color = "black")) + 
  scale_fill_manual(values = c("dodgerblue", "goldenrod1", "darkorange1", "seagreen3", "orchid3", "grey"))
count
#ggsave("Output/Figs/GOslim/MF/SpeciesCounts_GOslim.MF_20220417.pdf", count, width = 40, height = 30, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/SpeciesCounts_GOslim.MF_20220417.png", count, width = 40, height = 30, units = c("in"))

# plot by location/sediment type
all.go.MF.slim <- all.go.MF.slim %>% mutate(Location = 
                                              case_when(Species == "A.cervicornis" ~ "Florida", 
                                                        Species == "M.cavernosa" ~ "Florida",
                                                        Species == "O.faveolata" ~ "Florida",
                                                        Species == "M.capitata" ~ "Hawai'i",
                                                        Species == "P.acuta" ~ "Hawai'i",
                                                        Species == "P.lobata" ~ "Hawai'i"))

# count GOslim by location
count_by_location <- all.go.MF.slim %>%
  dplyr::count(Location, GO.Slim.Term)
count_by_location

# plot
count_location_plot <- ggplot(count_by_location, aes(fill = Location, y = n, x = GO.Slim.Term)) +
  geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Location") +
  #coord_flip() +
    theme_bw() +
    #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 350)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("chartreuse3", "chocolate2"))
count_location_plot
ggsave("Output/Figs/GOslim/MF/LocationsCounts_GOslim.MF_20221206.pdf", count_location_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/MF/LocationsCounts_GOslim.MF_20221206.png", count_location_plot, width = 49, height = 40, units = c("in"))

# plot by morphology type
all.go.MF.slim <- all.go.MF.slim %>% mutate(Morphology = 
                                              case_when(Species == "A.cervicornis" ~ "Branching", 
                                                        Species == "M.cavernosa" ~ "Massive",
                                                        Species == "O.faveolata" ~ "Massive",
                                                        Species == "M.capitata" ~ "Intermediate",
                                                        Species == "P.acuta" ~ "Branching",
                                                        Species == "P.lobata" ~ "Massive"))

# count GOslim by morphology
count_by_morph <- all.go.MF.slim %>%
  dplyr::count(Morphology, GO.Slim.Term)
count_by_morph

# plot
count_morph_plot <- ggplot(count_by_morph, aes(fill = Morphology, y = n, x = GO.Slim.Term)) +
    geom_bar(position = "dodge", 
           stat = "identity", 
           colour="black",
           width = 0.9,
           size = 2) +
  # geom_text(aes(label = n), 
  #           position = position_dodge(0.9), 
  #           size = 10, 
  #           face = "bold") +
  ylab("GO Term Counts\n") + 
  #ggtitle(label = "Counts of GO Slim Categories by Morphology") +
  #coord_flip() +
      theme_bw() +
    #theme_classic() +
  theme(axis.text.x = element_text(angle = 65,
                                   #vjust = 0.5, 
                                   hjust= 1, 
                                   size=80, 
                                   colour = "black"), 
        axis.title.x = element_text(size = 0),
        axis.text.y = element_text(size = 60, colour = "black"),
        axis.title.y = element_text(size = 80, face = "bold"),
        axis.line = element_line(colour = 'black', size = 2),
        plot.title = element_text(size = 100, hjust = 0.5),
        plot.margin = margin(3,3,3,3, "cm")) + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)), limits = c(0, 150)) + 
  theme(legend.title = element_text(size = 55, face = "bold"), 
        legend.key.size = unit(5, "cm"),
        legend.key = element_rect(fill = "white", colour = "black"),
        legend.text = element_text(size=45), 
        #legend.position = c(1, 1), 
        legend.justification = c("right"),
        legend.box.just = "right",
        legend.box.margin = margin(t = 2, r = 1, b = 2, l = 1, unit = "cm"),
        legend.background = element_rect(fill = "white"),
        legend.box.background = element_rect(color="white", size=5)) +
        scale_fill_manual(values = c("#0066CC", "#E4E408"))
count_morph_plot
ggsave("Output/Figs/GOslim/MF/MorphologyCounts_GOslim.MF_20221206.pdf", count_morph_plot, width = 49, height = 40, units = c("in"))
ggsave("Output/Figs/GOslim/MF/MorphologyCounts_GOslim.MF_20221206.png", count_morph_plot, width = 49, height = 40, units = c("in"))
```







## CC
### Determine all categories to plot by
```{r}
unique(all.go.CC.slim$GO.Slim.Term)
# [1] "other cellular component"     "nucleus"                      "other membranes"             
#  [4] "other cytoplasmic organelle"  "cytoskeleton"                 "ER/Golgi"                    
#  [7] "plasma membrane"              "mitochondrion"                "non-structural extracellular"
# [10] "cytosol"                      "translational apparatus"                                       
```

Look at all_GOslim.CC plot to see which GOslim term has the most associated GO terms. Then, plot by that GOslim term. Going to subset and plot by GOslim terms that appear in all_GOslim.CC_20220125.pdf: 

(1) cytoskeleton
(2) ER/Golgi
(3) plasma membrane
(4) mitochondrion
(5) non-structural extracellular
(6) nucleus
(7) other cellular component
(8) other cytoplasmic organelle
(9) other membranes
(10) cytosol
(11) translational apparatus


(1) "cytoskeleton"
```{r}
go.slim.Cytoskeleton.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="cytoskeleton")

GO.Cytoskeleton.subset <- ggplot(go.slim.Cytoskeleton.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.Cytoskeleton.subset
#ggsave("Output/Figs/GOslim/CC/Cytoskeleton.Subset_GOslim.CC_20220419.pdf", GO.Cytoskeleton.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/Cytoskeleton.Subset_GOslim.CC_20220419.png", GO.Cytoskeleton.subset, width = 40, height = 40, units = c("in"))
```

(2) "ER/Golgi"
```{r}
go.slim.EG.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="ER/Golgi")

GO.EG.subset <- ggplot(go.slim.EG.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.EG.subset
#ggsave("Output/Figs/GOslim/CC/EG.Subset_GOslim.CC_20220419.pdf", GO.EG.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/EG.Subset_GOslim.CC_20220419.png", GO.EG.subset, width = 40, height = 40, units = c("in"))
```

(3) "plasma membrane"
```{r}
go.slim.PMem.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="plasma membrane")

GO.PMem.subset <- ggplot(go.slim.PMem.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.PMem.subset
#ggsave("Output/Figs/GOslim/CC/PMem.Subset_GOslim.CC_20220419.pdf", GO.PMem.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/PMem.Subset_GOslim.CC_20220419.png", GO.PMem.subset, width = 40, height = 40, units = c("in"))
```

(4) 'mitochondrion'
```{r}
go.slim.Mito.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="mitochondrion")

GO.Mito.subset <- ggplot(go.slim.Mito.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.Mito.subset
#ggsave("Output/Figs/GOslim/CC/Mito.Subset_GOslim.CC_20220419.pdf", GO.Mito.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/Mito.Subset_GOslim.CC_20220419.png", GO.Mito.subset, width = 40, height = 40, units = c("in"))
```

(5) 'non-structural extracellular'
```{r}
go.slim.NSE.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="non-structural extracellular")

GO.NSE.subset <- ggplot(go.slim.NSE.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.NSE.subset
#ggsave("Output/Figs/GOslim/CC/NSE.Subset_GOslim.CC_20220419.pdf", GO.NSE.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/NSE.Subset_GOslim.CC_20220419.png", GO.NSE.subset, width = 40, height = 40, units = c("in"))
```

(6) 'nucleus'
```{r}
go.slim.Nucleus.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="nucleus")

GO.Nucleus.subset <- ggplot(go.slim.Nucleus.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.Nucleus.subset
#ggsave("Output/Figs/GOslim/CC/Nucleus.Subset_GOslim.CC_20220419.pdf", GO.Nucleus.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/Nucleus.Subset_GOslim.CC_20220419.png", GO.Nucleus.subset, width = 40, height = 40, units = c("in"))
```

(7) 'other cellular component'
```{r}
go.slim.OCC.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="other cellular component")

GO.OCC.subset <- ggplot(go.slim.OCC.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OCC.subset
#ggsave("Output/Figs/GOslim/CC/OCC.Subset_GOslim.CC_20220419.pdf", GO.OCC.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/OCC.Subset_GOslim.CC_20220419.png", GO.OCC.subset, width = 40, height = 40, units = c("in"))
```

(8) 'other cytoplasmic organelle'
```{r}
go.slim.OCO.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="other cytoplasmic organelle")

GO.OCO.subset <- ggplot(go.slim.OCO.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OCO.subset
#ggsave("Output/Figs/GOslim/CC/OCO.Subset_GOslim.CC_20220419.pdf", GO.OCO.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/OCO.Subset_GOslim.CC_20220419.png", GO.OCO.subset, width = 40, height = 40, units = c("in"))
```

(9) 'other membranes'
```{r}
go.slim.OM.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="other membranes")

GO.OM.subset <- ggplot(go.slim.OM.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OM.subset
#ggsave("Output/Figs/GOslim/CC/OM.Subset_GOslim.CC_20220419.pdf", GO.OM.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/OM.Subset_GOslim.CC_20220419.png", GO.OM.subset, width = 40, height = 40, units = c("in"))
```

(10) 'cytosol'
```{r}
go.slim.Cytosol.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="cytosol")

GO.Cytosol.subset <- ggplot(go.slim.Cytosol.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.Cytosol.subset
#ggsave("Output/Figs/GOslim/CC/Cytosol.Subset_GOslim.CC_20220419.pdf", GO.Cytosol.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/Cytosol.Subset_GOslim.CC_20220419.png", GO.Cytosol.subset, width = 40, height = 40, units = c("in"))
```

(11) 'translational apparatus'
```{r}
go.slim.TA.subset <- all.go.CC.slim %>% filter(GO.Slim.Term=="translational apparatus")

GO.TA.subset <- ggplot(go.slim.TA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.TA.subset
#ggsave("Output/Figs/GOslim/CC/TA.Subset_GOslim.CC_20220419.pdf", GO.TA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/CC/TA.Subset_GOslim.CC_20220419.png", GO.TA.subset, width = 40, height = 40, units = c("in"))
```



## MF
### Determine all categories to plot by
```{r}
unique(all.go.MF.slim$GO.Slim.Term)
# [1] "signal transduction activity"      "other molecular function"          "nucleic acid binding activity"    
# [4] "kinase activity"                   "transporter activity"              "enzyme regulator activity"        
# [7] "transcription regulatory activity" "cytoskeletal activity"                             
```

Look at all_GOslim.MF plot to see which GOslim term has the most associated GO terms. Then, plot by that GOslim term. Going to subset and plot by GOslim terms that appear in all_GOslim.MF_20220125.pdf: 


(1) cytoskeletal activity
(2) enzyme regulator activity
(3) kinase activity
(4) nucleic acid binding activity
(5) other molecular function
(6) signal transduction activity
(7) transcription regulatory activity
(8) transporter activity


(1) 'cytoskeletal activity'
```{r}
go.slim.CytoA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="cytoskeletal activity")

GO.CtyoA.subset <- ggplot(go.slim.CytoA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.CtyoA.subset
#ggsave("Output/Figs/GOslim/MF/CytoA.Subset_GOslim.MF_20220419.pdf", GO.CtyoA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/CytoA.Subset_GOslim.MF_20220419.png", GO.CtyoA.subset, width = 40, height = 40, units = c("in"))
```

(2) 'enzyme regulator activity'
```{r}
go.slim.ERA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="enzyme regulator activity")

GO.ERA.subset <- ggplot(go.slim.ERA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.ERA.subset
#ggsave("Output/Figs/GOslim/MF/ERA.Subset_GOslim.MF_20220419.pdf", GO.ERA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/ERA.Subset_GOslim.MF_20220419.png", GO.ERA.subset, width = 40, height = 40, units = c("in"))
```

(3) 'kinase activity'
```{r}
go.slim.KA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="kinase activity")

GO.KA.subset <- ggplot(go.slim.KA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.KA.subset
#ggsave("Output/Figs/GOslim/MF/KA.Subset_GOslim.MF_20220419.pdf", GO.KA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/KA.Subset_GOslim.MF_20220419.png", GO.KA.subset, width = 40, height = 40, units = c("in"))
```

(4) 'nucleic acid binding activity'
```{r}
go.slim.NABA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="nucleic acid binding activity")

GO.NABA.subset <- ggplot(go.slim.NABA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.NABA.subset
#ggsave("Output/Figs/GOslim/MF/NABA.Subset_GOslim.MF_20220419.pdf", GO.NABA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/NABA.Subset_GOslim.MF_20220419.png", GO.NABA.subset, width = 40, height = 40, units = c("in"))
```

(5) 'other molecular function'
```{r}
go.slim.OMF.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="other molecular function")

GO.OMF.subset <- ggplot(go.slim.OMF.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.OMF.subset
#ggsave("Output/Figs/GOslim/MF/OMF.Subset_GOslim.MF_20220419.pdf", GO.OMF.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/OMF.Subset_GOslim.MF_20220419.png", GO.OMF.subset, width = 40, height = 40, units = c("in"))
```

(6) 'signal transduction activity'
```{r}
go.slim.STA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="signal transduction activity")

GO.STA.subset <- ggplot(go.slim.STA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.STA.subset
#ggsave("Output/Figs/GOslim/MF/STA.Subset_GOslim.MF_20220419.pdf", GO.STA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/STA.Subset_GOslim.MF_20220419.png", GO.STA.subset, width = 40, height = 40, units = c("in"))
```

(7) 'transcription regulatory activity'
```{r}
go.slim.TRA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="transcription regulatory activity")

GO.TRA.subset <- ggplot(go.slim.TRA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.TRA.subset
#ggsave("Output/Figs/GOslim/MF/TRA.Subset_GOslim.MF_20220419.pdf", GO.TRA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/TRA.Subset_GOslim.MF_20220419.png", GO.TRA.subset, width = 40, height = 40, units = c("in"))
```

(8) 'transporter activity'
```{r}
go.slim.TA.subset <- all.go.MF.slim %>% filter(GO.Slim.Term=="transporter activity")

GO.TA.subset <- ggplot(go.slim.TA.subset, aes(x = Species, y = term)) + 
  geom_tile(aes(fill =over_represented_pvalue)) + 
  facet_grid(GO.Slim.Term ~ ., scales = "free_y", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
                     strip.text.y = element_text(angle=0, size = 25),
                     strip.text.x = element_text(size = 25),
                     axis.text = element_text(size = 30))
GO.TA.subset
#ggsave("Output/Figs/GOslim/MF/TA.Subset_GOslim.MF_20220419.pdf", GO.TA.subset, width = 40, height = 40, units = c("in"))
#ggsave("Output/Figs/GOslim/MF/TA.Subset_GOslim.MF_20220419.png", GO.TA.subset, width = 40, height = 40, units = c("in"))
```
